<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hadley Wickham y Jenny Bryan">
<meta name="description" content="Aprenda a crear un paquete, la unidad fundamental de contenido compartible, reutilizable, y código R reproducible.">
<title>6&nbsp; Código R – Paquetes de R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./data.html" rel="next">
<link href="./package-within.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cecd649be66239f4a3c9dceaf651ba2d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script><script defer="" data-domain="r-pkgs.org" src="https://plausible.io/js/plausible.js"></script><meta name="google-site-verification" content="kphyQu6n4JhBUuoLZxnJpD9dbw9q5FLwqXb9AkI2fhU">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./code.html">Componentes de un paquete</a></li><li class="breadcrumb-item"><a href="./code.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Código R</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Buscar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Paquetes de R</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/hadley/r-pkgs/">
            Original
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/davidrsch/r-pkgses">
            Traducción
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo lector">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">¡Bienvenidos!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Empezando</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Todo el juego</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Configuración del sistema</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Estructura y estado del paquete</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Flujos de trabajo de desarrollo fundamentales</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./package-within.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">El paquete en el interior de su código</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Componentes de un paquete</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Código R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Datos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Otros componentes</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Metadatos del paquete</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><code>DESCRIPTION</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-mindset-background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencias: mentalidad y antecedentes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-in-practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencias: en la práctica</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Licencias</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Probar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Conceptos básicos de pruebas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Diseñar su conjunto de pruebas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Técnicas de prueba avanzadas</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentación</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./man.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Documentación de la función</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vignettes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Viñetas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other-markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Otros archivos markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Sitio web</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Mantenimiento y distribución</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software-development-practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Prácticas de desarrollo de software</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lifecycle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Ciclo de vida</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Subiendo a CRAN</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Apéndices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-CMD-check.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title"><code>R CMD check</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
<li><a href="#sec-code-organising" id="toc-sec-code-organising" class="nav-link active" data-scroll-target="#sec-code-organising"><span class="header-section-number">6.1</span> Organizar funciones en archivos</a></li>
  <li><a href="#sec-code-load-all" id="toc-sec-code-load-all" class="nav-link" data-scroll-target="#sec-code-load-all"><span class="header-section-number">6.2</span> Comentarios rápidos a través de <code>load_all()</code></a></li>
  <li><a href="#code-style" id="toc-code-style" class="nav-link" data-scroll-target="#code-style"><span class="header-section-number">6.3</span> Code style</a></li>
  <li>
<a href="#sec-code-when-executed" id="toc-sec-code-when-executed" class="nav-link" data-scroll-target="#sec-code-when-executed"><span class="header-section-number">6.4</span> Comprender cuándo se ejecuta el código</a>
  <ul class="collapse">
<li><a href="#ejemplo-un-camino-devuelto-por-system.file" id="toc-ejemplo-un-camino-devuelto-por-system.file" class="nav-link" data-scroll-target="#ejemplo-un-camino-devuelto-por-system.file"><span class="header-section-number">6.4.1</span> Ejemplo: Un camino devuelto por <code>system.file()</code></a></li>
  <li><a href="#ejemplo-colores-disponibles" id="toc-ejemplo-colores-disponibles" class="nav-link" data-scroll-target="#ejemplo-colores-disponibles"><span class="header-section-number">6.4.2</span> Ejemplo: Colores disponibles</a></li>
  <li><a href="#ejemplo-asignar-un-alias-a-una-funci%C3%B3n" id="toc-ejemplo-asignar-un-alias-a-una-función" class="nav-link" data-scroll-target="#ejemplo-asignar-un-alias-a-una-funci%C3%B3n"><span class="header-section-number">6.4.3</span> Ejemplo: asignar un alias a una función</a></li>
  </ul>
</li>
  <li>
<a href="#sec-code-r-landscape" id="toc-sec-code-r-landscape" class="nav-link" data-scroll-target="#sec-code-r-landscape"><span class="header-section-number">6.5</span> Respeta el paisaje de R</a>
  <ul class="collapse">
<li><a href="#administrar-estado-con-withr" id="toc-administrar-estado-con-withr" class="nav-link" data-scroll-target="#administrar-estado-con-withr"><span class="header-section-number">6.5.1</span> Administrar estado con withr</a></li>
  <li><a href="#restaurar-el-estado-con-baseon.exit" id="toc-restaurar-el-estado-con-baseon.exit" class="nav-link" data-scroll-target="#restaurar-el-estado-con-baseon.exit"><span class="header-section-number">6.5.2</span> Restaurar el estado con <code>base::on.exit()</code></a></li>
  <li><a href="#aislar-los-efectos-secundarios" id="toc-aislar-los-efectos-secundarios" class="nav-link" data-scroll-target="#aislar-los-efectos-secundarios"><span class="header-section-number">6.5.3</span> Aislar los efectos secundarios</a></li>
  <li><a href="#sec-code-onLoad-onAttach" id="toc-sec-code-onLoad-onAttach" class="nav-link" data-scroll-target="#sec-code-onLoad-onAttach"><span class="header-section-number">6.5.4</span> Cuando <strong>sí</strong> necesitas efectos secundarios</a></li>
  </ul>
</li>
  <li><a href="#controles-de-salud-constantes" id="toc-controles-de-salud-constantes" class="nav-link" data-scroll-target="#controles-de-salud-constantes"><span class="header-section-number">6.6</span> Controles de salud constantes</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./code.html">Componentes de un paquete</a></li><li class="breadcrumb-item"><a href="./code.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Código R</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-r" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Código R</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>El primer principio al crear un paquete es que todo el código R va al directorio <code>R/</code>. En este capítulo, aprenderá a organizar sus funciones en archivos, mantener un estilo consistente y reconocer los requisitos más estrictos para las funciones en un paquete (en comparación con un script). También le recordaremos los flujos de trabajo fundamentales para realizar pruebas de manejo y verificar formalmente un paquete en desarrollo: <code>load_all()</code>, <code>test()</code>, y <code>check()</code>.</p>
<section id="sec-code-organising" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="sec-code-organising">
<span class="header-section-number">6.1</span> Organizar funciones en archivos</h2>
<p>La única regla estricta es que su paquete debe almacenar sus definiciones de funciones en scripts R, es decir, archivos con extensión <code>.R</code>, que se encuentran en el directorio <code>R/</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Sin embargo, algunas convenciones más pueden hacer que el código fuente de su paquete sea más fácil de navegar y evitarle tener que volver a responder “¿Cómo debería nombrar esto?” cada vez que crea un nuevo archivo. La Guía de estilo de Tidyverse ofrece algunos <a href="https://style.tidyverse.org/files.html">consejos generales sobre nombres de archivos</a> y también <a href="https://style.tidyverse.org/package-files.html">consejos que se aplican específicamente a archivos en un paquete</a>. Nosotros ampliamos esto aquí.</p>
<p>El nombre del archivo debe ser significativo y transmitir qué funciones están definidas en él. Si bien eres libre de organizar funciones en archivos como desees, los dos extremos son malos: no coloques todas las funciones en un archivo y no coloques cada función en su propio archivo separado. Este consejo debe informar su política general, pero hay excepciones a cada regla. Si una función específica es muy grande o tiene mucha documentación, puede tener sentido darle su propio archivo, con el nombre de la función. Más a menudo, un único archivo <code>.R</code> contendrá múltiples definiciones de funciones: como una función principal y sus ayudas de apoyo, una familia de funciones relacionadas o alguna combinación de las dos.</p>
<p><a href="#tbl-putting-functions-in-files" class="quarto-xref">Tabla&nbsp;<span>6.1</span></a> presenta algunos ejemplos de la fuente real del paquete <a href="http://tidyr.tidyverse.org/">tidyr</a> en la versión 1.1.2. Hay algunas desviaciones de las reglas estrictas dadas anteriormente, lo que ilustra que hay mucho margen para juzgar aquí.</p>
<div class="cell">
<div id="tbl-putting-functions-in-files" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-putting-functions-in-files-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;6.1: Different ways to organize functions in files.
</figcaption><div aria-describedby="tbl-putting-functions-in-files-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Organising principle</th>
<th style="text-align: left;">Source file</th>
<th style="text-align: left;">Comments</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Una función</td>
<td style="text-align: left;"><a href="https://github.com/tidyverse/tidyr/blob/v1.1.2/R/uncount.R">tidyr/R/uncount.R</a></td>
<td style="text-align: left;">Define exactamente una función, <code>uncount()</code>, que no es particularmente grande, pero no encaja naturalmente en ningún otro archivo <code>.R</code>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Función principal más ayudantes</td>
<td style="text-align: left;"><a href="https://github.com/tidyverse/tidyr/blob/v1.1.2/R/separate.R">tidyr/R/separate.R</a></td>
<td style="text-align: left;">Define el <code>separate()</code> orientado al usuario (un genérico de S3), un método <code>data.frame</code> y ayudantes privados</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Familia de funciones</td>
<td style="text-align: left;"><a href="https://github.com/tidyverse/tidyr/blob/v1.1.2/R/rectangle.R">tidyr/R/rectangle.R</a></td>
<td style="text-align: left;">Define una familia de funciones para “rectangular” listas anidadas (funciones <code>hoist()</code> y <code>unnest()</code>), todas documentadas juntas en un gran tema de ayuda, además de ayudas privadas.</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Otro archivo que ve a menudo en estado salvaje es <code>R/utils.R</code>. Este es un lugar común para definir pequeñas utilidades que se utilizan dentro de múltiples funciones de paquetes. Dado que sirven como ayuda para múltiples funciones, colocarlos en <code>R/utils.R</code> hace que sea más fácil redescubrirlos cuando regrese a su paquete después de un largo descanso.</p>
<p>Bob Rudis reunió una colección de dichos archivos e hizo algunos análisis en la publicación <a href="https://rud.is/b/2018/04/08/dissecting-r-package-utility-belts/">Dissecting R Package “Utility Belts”</a>.</p>
</div>
</div>
<p>Si es muy difícil predecir en qué archivo se encuentra una función, eso sugiere que es hora de separar sus funciones en más archivos o reconsiderar cómo nombra sus funciones y/o archivos.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
RStudio
</div>
</div>
<div class="callout-body-container callout-body">
<p>La organización de funciones dentro de archivos es menos importante en RStudio, que ofrece dos formas de saltar a la definición de una función:</p>
<ul>
<li>
<p>Presione Ctrl + <code>.</code> (el punto) para abrir la herramienta <em>Ir a archivo/función</em>, como se muestra en <a href="#fig-go-to-file-function" class="quarto-xref">Figura&nbsp;<span>6.1</span></a>, luego comience a escribir el nombre. Siga escribiendo para limitar la lista y, finalmente, elija una función (o archivo) para visitar. Esto funciona tanto para funciones como para archivos de su proyecto.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-go-to-file-function" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Captura de pantalla de la herramienta &quot;Ir a archivo/función&quot; en el IDE de RStudio. Es un cuadro de texto con el cursor dentro.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-go-to-file-function-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/file-finder.png" class="img-fluid figure-img" alt="Captura de pantalla de la herramienta &quot;Ir a archivo/función&quot; en el IDE de RStudio. Es un cuadro de texto con el cursor dentro.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-go-to-file-function-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.1: Vaya a Archivo/Función en RStudio.
</figcaption></figure>
</div>
</div>
</div>
</li>
<li><p>Con el cursor en el nombre de una función o con un nombre de función seleccionado, presione F2. Esto funciona para funciones definidas en su paquete o en otro paquete.</p></li>
</ul>
<p>Después de navegar a una función con uno de estos métodos, regrese al punto de partida haciendo clic en la flecha hacia atrás en la parte superior izquierda del editor. (<img src="images/arrows.png" width="33" height="16">) o presionando Ctrl + F9 (Windows &amp; Linux) o Cmd + F9 (macOS).</p>
</div>
</div>
</section><section id="sec-code-load-all" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="sec-code-load-all">
<span class="header-section-number">6.2</span> Comentarios rápidos a través de <code>load_all()</code>
</h2>
<p>A medida que agrega o modifica funciones definidas en archivos debajo de <code>R/</code>, naturalmente querrá probarlas. Queremos reiterar nuestra firme recomendación de utilizar <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code> para que estén disponibles para la exploración interactiva en lugar de, por ejemplo, archivos <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> a continuación <code>R/</code>. La cobertura principal de <code>load_all()</code> está en <a href="workflow101.html#sec-workflow101-load-all" class="quarto-xref"><span>Sección 4.4</span></a> y <code>load_all()</code> también aparece como una de las tareas de desarrollo naturales en <a href="whole-game.html#sec-whole-game-load-all" class="quarto-xref"><span>Sección 1.8</span></a>. La importancia de <code>load_all()</code> en el flujo de trabajo de prueba se explica en <a href="testing-design.html#sec-testing-design-tension" class="quarto-xref"><span>Sección 14.2.5</span></a>. En comparación con las alternativas, <code>load_all()</code> le ayuda a iterar más rápidamente y proporciona una excelente aproximación al régimen de espacio de nombres de un paquete instalado.</p>
</section><section id="code-style" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="code-style">
<span class="header-section-number">6.3</span> Code style</h2>
<p>Recomendamos seguir la guía de estilo de tidyverse (<a href="https://style.tidyverse.org" class="uri">https://style.tidyverse.org</a>), que detalla muchos más detalles que los que podemos encontrar aquí. Su formato también le permite ser un documento más dinámico que este libro.</p>
<p>Aunque la guía de estilo explica el “qué” y el “por qué”, otra decisión importante es <em>cómo</em> imponer un estilo de código específico. Para ello recomendamos el paquete styler (<a href="https://styler.r-lib.org" class="uri">https://styler.r-lib.org</a>); su comportamiento predeterminado aplica la guía de estilo tidyverse. Hay muchas formas de aplicar Styler a su código, según el contexto:</p>
<ul>
<li>
<code>styler::style_pkg()</code> rediseña un paquete R completo.</li>
<li>
<code>styler::style_dir()</code> Cambia el estilo de todos los archivos en un directorio.</li>
<li>
<code><a href="https://usethis.r-lib.org/reference/tidyverse.html">usethis::use_tidy_style()</a></code> es un contenedor que aplica una de las funciones anteriores dependiendo de si el proyecto actual es un paquete R o no.</li>
<li>
<code>styler::style_file()</code> Cambia el estilo de un solo archivo.</li>
<li>
<code>styler::style_text()</code> Cambia el estilo de un vector de caracteres.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
RStudio
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cuando se instala styler, el menú de complementos de RStudio ofrecerá varias formas adicionales de aplicar estilo al código:</p>
<ul>
<li>la selección activa</li>
<li>el archivo activo</li>
<li>el paquete activo</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Advertencia
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si no usas Git u otro sistema de control de versiones, aplicar una función como <code>styler::style_pkg()</code> es estresante y algo peligroso, porque no tienes una forma de ver exactamente qué cambió y aceptar/rechazar dichos cambios. de forma granular.</p>
</div>
</div>
<p>El paquete styler también se puede integrar con varias plataformas para alojar el código fuente y realizar una integración continua. Por ejemplo, los paquetes tidyverse usan una acción de GitHub que cambia el estilo de un paquete cuando se activa mediante un comentario especial (<code>/style</code>) en una solicitud de extracción. Esto permite a los mantenedores concentrarse en revisar el contenido de la solicitud de extracción, sin tener que preocuparse por pequeños problemas de espacios en blanco o sangrías.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> .</p>
</section><section id="sec-code-when-executed" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="sec-code-when-executed">
<span class="header-section-number">6.4</span> Comprender cuándo se ejecuta el código</h2>
<p>Hasta ahora, probablemente hayas estado escribiendo <strong>scripts</strong>, código R guardado en un archivo que ejecutas interactivamente, tal vez usando un IDE y/o <code><a href="https://rdrr.io/r/base/source.html">source()</a></code>, o de forma no interactiva a través de <code>Rscript</code>. Hay dos diferencias principales entre el código en scripts y paquetes:</p>
<ul>
<li><p>En un script, el código se ejecuta… ¡cuando lo ejecutas! La incomodidad de esta afirmación refleja que es difícil siquiera pensar en este tema con un guión. Sin embargo, debemos hacerlo para poder apreciar que el código de un paquete se ejecuta <strong>cuando se compila el paquete</strong>. Esto tiene grandes implicaciones sobre cómo escribe el código debajo de <code>R/</code>: el código del paquete solo debe crear objetos, la gran mayoría de los cuales serán funciones.</p></li>
<li><p>Las funciones de tu paquete se utilizarán en situaciones que no imaginabas. Esto significa que sus funciones deben ser cuidadosas en la forma en que interactúan con el mundo exterior.</p></li>
</ul>
<p>Ampliamos el primer punto aquí y el segundo en la siguiente sección. Estos temas también se ilustran concretamente en <a href="package-within.html#sec-package-within-build-time-run-time" class="quarto-xref"><span>Sección 5.6</span></a>.</p>
<p>Cuando llamas <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> a un script, cada línea de código se ejecuta y los resultados están disponibles inmediatamente. Las cosas son diferentes con el código del paquete, porque se carga en dos pasos. Cuando se compila el paquete binario (a menudo, mediante CRAN), se ejecuta todo el código en <code>R/</code> y se guardan los resultados. Cuando adjunta un paquete con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, estos resultados almacenados en caché se recargan y ciertos objetos (principalmente funciones) quedan disponibles para su uso. Los detalles completos sobre lo que significa que un paquete esté en formato binario se proporcionan en <a href="structure.html#sec-structure-binary" class="quarto-xref"><span>Sección 3.4</span></a>. Nos referimos a la creación del paquete binario como “tiempo de compilación” (binario) y, específicamente, nos referimos a cuando se ejecuta <code>R CMD INSTALL --build</code>. (Se podría pensar que esto es lo que hace <code>R CMD build</code>, pero eso en realidad crea un paquete empaquetado, también conocido como un “tarball fuente”.) Para los usuarios de paquetes CRAN de macOS y Windows, el tiempo de compilación es cuando CRAN creó el paquete binario para su sistema operativo. Para aquellos que instalan paquetes desde el código fuente, el tiempo de compilación es esencialmente cuando (construyeron e) instalaron el paquete.</p>
<p>Considere la asignación <code>x &lt;- Sys.time()</code>. Si pones esto en un script, <code>x</code> te dice cuándo el script fue <code><a href="https://rdrr.io/r/base/source.html">source()</a></code>d. Pero si coloca ese mismo código en el nivel superior de un paquete, <code>x</code> le indica cuándo se <em>construyó</em> el binario del paquete. En <a href="package-within.html#sec-package-within-build-time-run-time" class="quarto-xref"><span>Sección 5.6</span></a>, mostramos un ejemplo completo de esto en el contexto de la formación de marcas de tiempo dentro de un paquete.</p>
<p>La conclusión principal es esta:</p>
<blockquote class="blockquote">
<p>Cualquier código R fuera de una función es sospechoso y debe revisarse cuidadosamente.</p>
</blockquote>
<p>A continuación, exploramos algunos ejemplos del mundo real que muestran lo fácil que es quedar quemado por este problema de “tiempo de construcción versus tiempo de carga”. Afortunadamente, una vez que se diagnostica este problema, generalmente no es difícil solucionarlo.</p>
<section id="ejemplo-un-camino-devuelto-por-system.file" class="level3" data-number="6.4.1"><h3 data-number="6.4.1" class="anchored" data-anchor-id="ejemplo-un-camino-devuelto-por-system.file">
<span class="header-section-number">6.4.1</span> Ejemplo: Un camino devuelto por <code>system.file()</code>
</h3>
<p>El paquete shinybootstrap2 alguna vez tuvo este código a continuación <code>R/</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dataTableDependency</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">htmlDependency</span><span class="op">(</span></span>
<span>    <span class="st">"datatables"</span>, <span class="st">"1.10.2"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"www/datatables"</span>, package <span class="op">=</span> <span class="st">"shinybootstrap2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    script <span class="op">=</span> <span class="st">"js/jquery.dataTables.min.js"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">htmlDependency</span><span class="op">(</span></span>
<span>    <span class="st">"datatables-bootstrap"</span>, <span class="st">"1.10.2"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"www/datatables"</span>, package <span class="op">=</span> <span class="st">"shinybootstrap2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    stylesheet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"css/dataTables.bootstrap.css"</span>, <span class="st">"css/dataTables.extra.css"</span><span class="op">)</span>,</span>
<span>    script <span class="op">=</span> <span class="st">"js/dataTables.bootstrap.js"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Entonces, <code>dataTableDependency</code> era un objeto de lista definido en el código del paquete de nivel superior y su valor se construyó a partir de rutas obtenidas a través de <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code>. Como se describe en <a href="https://github.com/rstudio/htmltools/issues/22">un problema de GitHub</a>,</p>
<blockquote class="blockquote">
<p>Esto funciona bien cuando el paquete se crea y se prueba en la misma máquina. Sin embargo, si el paquete se construye en una máquina y luego se usa en otra (como es el caso con los paquetes binarios CRAN), esto fallará: la dependencia apuntará al directorio incorrecto en el host.</p>
</blockquote>
<p>El corazón de la solución es asegurarse de que <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> se llame desde una función, en tiempo de ejecución. De hecho, esta solución se realizó aquí (en commit <a href="https://github.com/rstudio/shinybootstrap2/commit/138db47e6bef195f14f6a14f4289ca445e9b2efa#diff-fedcc5cc99f3d44a4caf06f8e6e0ae08">138db47</a>) y en algunos otros paquetes que tenían código similar y se agregó una verificación relacionada en el propio <code>htmlDependency()</code>. Este problema en particular ahora sería detectado por “R CMD check”, debido a los cambios que vinieron con <a href="https://developer.r-project.org/Blog/public/2019/02/14/staged-install/index.html">instalación por etapas</a> a partir de R 3.6.0.</p>
</section><section id="ejemplo-colores-disponibles" class="level3" data-number="6.4.2"><h3 data-number="6.4.2" class="anchored" data-anchor-id="ejemplo-colores-disponibles">
<span class="header-section-number">6.4.2</span> Ejemplo: Colores disponibles</h3>
<p>El paquete crayon tiene una función, <code><a href="https://rdrr.io/pkg/crayon/man/show_ansi_colors.html">crayon::show_ansi_colors()</a></code>, que muestra una tabla de colores ANSI en la pantalla, básicamente para mostrar qué tipo de estilo es posible. En una versión anterior, la función se parecía a esta:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>show_ansi_colors <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">colors =</span> <span class="fu">num_colors</span>()) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (colors <span class="sc">&lt;</span> <span class="dv">8</span>) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Los colores no son compatibles"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (colors <span class="sc">&lt;</span> <span class="dv">256</span>) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(ansi_colors_8, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(ansi_colors_8)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(ansi_colors_256, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(ansi_colors_256)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>ansi_colors_8 <span class="ot">&lt;-</span> <span class="co"># código para generar un vector que cubre los colores básicos del terminal</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>ansi_colors_256 <span class="ot">&lt;-</span> <span class="co"># código para generar un vector que cubre 256 colores</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>donde <code>ansi_colors_8</code> y <code>ansi_colors_256</code> eran vectores de caracteres que exploraban un determinado conjunto de colores, presumiblemente diseñados mediante escapes ANSI.</p>
<p>El problema era que esos objetos se formaban y almacenaban en caché cuando se compilaba el paquete binario. Dado que esto sucede a menudo en un servidor sin cabeza, es probable que esto suceda en condiciones en las que los colores del terminal podrían no estar habilitados o incluso disponibles. Los usuarios del paquete instalado aún podrían llamar a <code>show_ansi_colors()</code> y <code>num_colors()</code> detectaría la cantidad de colores admitidos por su sistema (256 en la mayoría de las computadoras modernas). Pero entonces un objeto sin color se imprimiría en la pantalla (el problema original de GitHub es <a href="https://github.com/r-lib/crayon/issues/37">r-lib/crayon#37</a>).</p>
<p>La solución fue calcular los objetos de visualización con una función en tiempo de ejecución (en confirmación <a href="https://github.com/r-lib/crayon/commit/e2b368ac27331d82154f85299f18efbc36227caa">e2b368a</a>:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">show_ansi_colors</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">colors</span> <span class="op">=</span> <span class="fu">num_colors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">colors</span> <span class="op">&lt;</span> <span class="fl">8</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Colors are not supported"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">colors</span> <span class="op">&lt;</span> <span class="fl">256</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu">ansi_colors_8</span><span class="op">(</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu">ansi_colors_8</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu">ansi_colors_256</span><span class="op">(</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu">ansi_colors_256</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ansi_colors_8</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># código para generar un vector que cubre los colores básicos del terminal</span></span>
<span><span class="op">}</span></span>
<span>  </span>
<span><span class="va">ansi_colors_256</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># código para generar un vector que cubre 256 colores</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Literalmente, se usa el mismo código, simplemente se inserta en el cuerpo de una función sin argumentos (similar al ejemplo de shinybootstrap2). Cada referencia a, por ejemplo, el objeto <code>ansi_colors_8</code> se reemplaza por una llamada a la función <code>ansi_colors_8()</code>.</p>
<p>La conclusión principal es que las funciones que evalúan o exponen las capacidades de su paquete en el sistema de un usuario deben ejecutarse completamente en el sistema de su usuario. Es bastante fácil confiar accidentalmente en resultados que se almacenaron en caché en el momento de la compilación, muy posiblemente en una máquina diferente.</p>
</section><section id="ejemplo-asignar-un-alias-a-una-función" class="level3" data-number="6.4.3"><h3 data-number="6.4.3" class="anchored" data-anchor-id="ejemplo-asignar-un-alias-a-una-función">
<span class="header-section-number">6.4.3</span> Ejemplo: asignar un alias a una función</h3>
<p>Un último ejemplo muestra que, incluso si tiene cuidado de definir solo funciones debajo de <code>R/</code>, todavía hay algunas sutilezas a considerar. Imagine que desea que la función <code>foo()</code> en su paquete sea básicamente un alias para la función <code>blah()</code> de algún otro paquete, p.e. paqueteB. Quizás tengas la tentación de hacer esto:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">foo</span> <span class="op">&lt;-</span> <span class="fu">pkgB</span><span class="fu">::</span><span class="va">blah</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sin embargo, esto hará que <code>foo()</code> en su paquete refleje la definición de <code>pkgB::blah()</code> en la versión presente en la máquina donde se compila el paquete binario (a menudo CRAN), en ese momento. Si se descubre un error en <code>pkgB::blah()</code> y posteriormente se corrige, su paquete seguirá usando la versión anterior con errores, hasta que su paquete sea reconstruido (a menudo mediante CRAN) y sus usuarios actualicen, lo cual está completamente fuera de su alcance. Este enfoque alternativo lo protege de esto:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">foo</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu">pkgB</span><span class="fu">::</span><span class="fu">blah</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora, cuando su usuario llama a <code>foo()</code>, efectivamente está llamando a <code>pkgB::blah()</code>, en la versión instalada en <em>su</em> máquina en ese mismo momento.</p>
<p>Un ejemplo real de esto afectó a una versión anterior de knitr, relacionado con cómo el gancho “evaluar” predeterminado se estaba configurando en <code><a href="https://rdrr.io/pkg/evaluate/man/evaluate.html">evaluate::evaluate()</a></code> (el problema original es <a href="https://github%20.com/yihui/knitr/issues/1441">yihui/knitr#1441</a>, resuelto en commit <a href="https://github.com/yihui/knitr/commit/d6b53e0f15a8afd1de4987a86931ba54f886278d">d6b53e0</a>).</p>
</section></section><section id="sec-code-r-landscape" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="sec-code-r-landscape">
<span class="header-section-number">6.5</span> Respeta el paisaje de R</h2>
<p>Otra gran diferencia entre un script y un paquete es que otras personas usarán tu paquete y lo usarán en situaciones que nunca imaginaste. Esto significa que debe prestar atención al panorama de R, que incluye no sólo las funciones y objetos disponibles, sino también todas las configuraciones globales.</p>
<p>Ha cambiado el panorama de R si ha cargado un paquete con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, o ha cambiado una opción global con <code><a href="https://rdrr.io/r/base/options.html">options()</a></code>, o ha modificado el directorio de trabajo con <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code>. Si el comportamiento de <em>otras</em> funciones difiere antes y después de ejecutar su función, ha modificado el panorama. <a href="package-within.html#sec-package-within-side-effects" class="quarto-xref"><span>Sección 5.7</span></a> tiene un ejemplo concreto de esto que involucra zonas horarias y la impresión de fechas y horas específicas de la localidad. Cambiar el panorama es malo porque hace que el código sea mucho más difícil de entender.</p>
<p>Hay algunas funciones que modifican la configuración global que nunca debes usar porque existen mejores alternativas:</p>
<ul>
<li><p><strong>No use <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> o <code><a href="https://rdrr.io/r/base/library.html">require()</a></code></strong>. Estos modifican la ruta de búsqueda, afectando las funciones que están disponibles en el entorno global. En su lugar, debe utilizar la <code>DESCRIPTION</code> para especificar los requisitos de su paquete, como se describe en <a href="description.html" class="quarto-xref"><span>Capítulo 9</span></a>. Esto también garantiza que esos paquetes se instalen cuando se instala su paquete.</p></li>
<li><p><strong>Nunca use <code><a href="https://rdrr.io/r/base/source.html">source()</a></code></strong> para cargar código desde un archivo. <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> modifica el entorno actual, insertando los resultados de la ejecución del código. No hay ninguna razón para usar <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> dentro de su paquete, es decir, en un archivo debajo de <code>R/</code>. A veces la gente usa archivos <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> debajo de <code>R/</code> durante el desarrollo del paquete, pero como hemos explicado en <a href="workflow101.html#sec-workflow101-load-all" class="quarto-xref"><span>Sección 4.4</span></a> and <a href="#sec-code-load-all" class="quarto-xref"><span>Sección 6.2</span></a>, <code>load_all()</code> es una manera mucho mejor de cargar su código actual para explorarlo. Si está utilizando <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> para crear un conjunto de datos, es mejor usar los métodos en <a href="data.html" class="quarto-xref"><span>Capítulo 7</span></a> para incluir datos en un paquete.</p></li>
</ul>
<p>A continuación se incluye una lista no exhaustiva de otras funciones que se deben utilizar con precaución:</p>
<ul>
<li><code><a href="https://rdrr.io/r/base/options.html">options()</a></code></li>
<li><code><a href="https://rdrr.io/r/graphics/par.html">par()</a></code></li>
<li><code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code></li>
<li><code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv()</a></code></li>
<li><code><a href="https://rdrr.io/r/base/locales.html">Sys.setlocale()</a></code></li>
<li>
<code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> (o cualquier cosa que cambie el estado del generador de números aleatorios)</li>
</ul>
<!-- TODO: maybe tell one or more of the scary stories in <https://github.com/hadley/r-pkgs/issues/447> --><p>Si debe usarlos, asegúrese de limpiarlo usted mismo. A continuación mostramos cómo hacer esto usando funciones del paquete withr y en base R.</p>
<p>La otra cara de esta moneda es que debes evitar confiar en el panorama del usuario, que podría ser diferente al tuyo. Por ejemplo, las funciones que dependen de la clasificación de cadenas son peligrosas, porque el orden de clasificación depende de la configuración regional del sistema. A continuación vemos que las configuraciones regionales que uno puede encontrar en la práctica (C, inglés, francés, etc.) difieren en la forma en que clasifican las cadenas que no son ASCII o las letras mayúsculas versus minúsculas.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bernard"</span>, <span class="st">"bérénice"</span>, <span class="st">"béatrice"</span>, <span class="st">"boris"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_locale.html">with_locale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>LC_COLLATE <span class="op">=</span> <span class="st">"fr_FR"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in (function (category = "LC_ALL", locale = "") : OS</span></span>
<span><span class="co">#&gt; reports request to set locale to "fr_FR" cannot be honored</span></span>
<span><span class="co">#&gt; [1] "béatrice" "bérénice" "bernard"  "boris"</span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_locale.html">with_locale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>LC_COLLATE <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bernard"  "boris"    "béatrice" "bérénice"</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"b"</span>, <span class="st">"A"</span>, <span class="st">"b"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_locale.html">with_locale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>LC_COLLATE <span class="op">=</span> <span class="st">"en_CA"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in (function (category = "LC_ALL", locale = "") : OS</span></span>
<span><span class="co">#&gt; reports request to set locale to "en_CA" cannot be honored</span></span>
<span><span class="co">#&gt; [1] "a" "A" "A" "b" "b" "B"</span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_locale.html">with_locale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>LC_COLLATE <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "A" "A" "B" "a" "b" "b"</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si escribe sus funciones como si todos los usuarios tuvieran la misma configuración regional del sistema que usted, su código podría fallar.</p>
<section id="administrar-estado-con-withr" class="level3" data-number="6.5.1"><h3 data-number="6.5.1" class="anchored" data-anchor-id="administrar-estado-con-withr">
<span class="header-section-number">6.5.1</span> Administrar estado con withr</h3>
<p>Si necesita modificar el paisaje de R dentro de una función, entonces es importante asegurarse de que el cambio se revierta <em>al salir</em> de esa función. Esto es exactamente para lo que está diseñado <code><a href="https://rdrr.io/r/base/on.exit.html">base::on.exit()</a></code>. Utiliza <code><a href="https://rdrr.io/r/base/on.exit.html">on.exit()</a></code> dentro de una función para registrar el código para ejecutarlo más tarde, lo que restaura el paisaje a su estado original. Es importante tener en cuenta que las herramientas adecuadas, como <code><a href="https://rdrr.io/r/base/on.exit.html">on.exit()</a></code>, funcionan incluso si salimos de la función de forma anormal, es decir, debido a un error. Es por eso que vale la pena utilizar los métodos oficiales descritos aquí en lugar de cualquier solución que pueda hacer usted mismo.</p>
<p>Generalmente administramos el estado usando el <a href="https://withr.r-lib.org">paquete withr</a>, que proporciona un kit de herramientas flexible similar a <code><a href="https://rdrr.io/r/base/on.exit.html">on.exit()</a></code> (<code><a href="https://rdrr.io/r/base/on.exit.html">on.exit()</a></code> en sí está cubierto en la siguiente sección). <code><a href="https://withr.r-lib.org/reference/defer.html">withr::defer()</a></code> se puede utilizar como reemplazo directo de <code><a href="https://rdrr.io/r/base/on.exit.html">on.exit()</a></code>. ¿Por qué nos gusta tanto? En primer lugar, ofrece muchas funciones de conveniencia prediseñadas para cambios de estado que surgen con frecuencia. También apreciamos el comportamiento de pila predeterminado de withr (LIFO = último en entrar, primero en salir), su usabilidad en sesiones interactivas y su argumento <code>envir</code> (en uso más avanzado).</p>
<p>El patrón general es capturar el estado original, programar su eventual restauración “al salir” y luego realizar el cambio de estado. Algunos definidores, como <code><a href="https://rdrr.io/r/base/options.html">options()</a></code> o <code><a href="https://rdrr.io/r/graphics/par.html">par()</a></code>, devuelven el valor anterior cuando proporcionas un valor nuevo, lo que lleva a un uso similar al siguiente:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span>                        <span class="co"># width option "as found"</span></span>
<span>  <span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="co"># width option is 20</span></span>
<span>  <span class="fu">defer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span><span class="op">)</span>        <span class="co"># width option is 20</span></span>
<span>  <span class="va">...</span>                        <span class="co"># width option is 20</span></span>
<span><span class="op">}</span>                            <span class="co"># original width option restored</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ciertos cambios de estado, como la modificación de las opciones de sesión, surgen con tanta frecuencia que ofrece ayudas prediseñadas. <a href="#tbl-withr-greatest-hits" class="quarto-xref">Tabla&nbsp;<span>6.2</span></a> muestra algunos de los asistentes de cambio de estado que probablemente le resulten útiles:</p>
<div id="tbl-withr-greatest-hits" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-withr-greatest-hits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;6.2: Establecer un parámetro de gráficos withr.
</figcaption><div aria-describedby="tbl-withr-greatest-hits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead><tr class="header">
<th>Hacer/deshacer esto</th>
<th>withr funciones</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Establecer una opción R</td>
<td>
<code>with_options()</code>, <code>local_options()</code>
</td>
</tr>
<tr class="even">
<td>Establecer una variable de entorno</td>
<td>
<code>with_envvar()</code>, <code>local_envvar()</code>
</td>
</tr>
<tr class="odd">
<td>Cambiar directorio de trabajo</td>
<td>
<code>with_dir()</code>, <code>local_dir()</code>
</td>
</tr>
<tr class="even">
<td>Establecer un parámetro de gráficos</td>
<td>
<code>with_par()</code>, <code>local_par()</code>
</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Notarás que cada ayuda viene en dos formas que son útiles en diferentes situaciones:</p>
<ul>
<li>
<p><code>with_*()</code> Las funciones son mejores para ejecutar pequeños fragmentos de código con un estado modificado temporalmente. (Estas funciones están inspiradas en cómo funciona <code><a href="https://rdrr.io/r/base/with.html">base::with()</a></code>).</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">sig_digits</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># imagina mucho código aquí</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html">with_options</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="va">sig_digits</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># ... y mucho más código aquí</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p><code>local_*()</code> Las funciones son mejores para modificar el estado “desde ahora hasta que la función salga”.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">sig_digits</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html">local_options</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="va">sig_digits</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="co"># imagina mucho código aquí</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ul>
<p>Desarrollar código de forma interactiva con withr es agradable, porque se pueden programar acciones diferidas incluso en el entorno global. Esas acciones de limpieza pueden luego ejecutarse con <code><a href="https://withr.r-lib.org/reference/defer.html">withr::deferred_run()</a></code> o borrarse sin ejecución con <code><a href="https://withr.r-lib.org/reference/defer.html">withr::deferred_clear()</a></code>. Sin esta característica, puede ser complicado experimentar con código que necesita limpieza “al salir”, porque se comporta de manera muy diferente cuando se ejecuta en la consola que cuando se ejecuta con el brazo extendido dentro de una función.</p>
<p>Se brinda una cobertura más detallada en la viñeta de withr [Cambiando y restaurando el estado] (https://withr.r-lib.org/articles/changing-and-restoring-state.html) y withr también resultará útil cuando hablar sobre pruebas en <a href="testing-basics.html" class="quarto-xref"><span>Capítulo 13</span></a>.</p>
</section><section id="restaurar-el-estado-con-baseon.exit" class="level3" data-number="6.5.2"><h3 data-number="6.5.2" class="anchored" data-anchor-id="restaurar-el-estado-con-baseon.exit">
<span class="header-section-number">6.5.2</span> Restaurar el estado con <code>base::on.exit()</code>
</h3>
<p>Así es como se ve el patrón general “guardar, programar restauración, cambiar” cuando se usa <code><a href="https://rdrr.io/r/base/on.exit.html">base::on.exit()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, pty <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Otros cambios de estado no están disponibles con ese tipo de configurador y debe implementarlos usted mismo.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">scratch_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="va">scratch_file</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.create</a></span><span class="op">(</span><span class="va">scratch_file</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tenga en cuenta que especificamos <code>on.exit(..., add = TRUE)</code>, porque casi siempre desea este comportamiento, es decir, <em>agregar</em> a la lista de tareas de limpieza diferidas en lugar de <em>reemplazarlas</em> por completo. Esto (y el valor predeterminado de <code>después</code>) están relacionados con nuestra preferencia por <code><a href="https://withr.r-lib.org/reference/defer.html">withr::defer()</a></code>, cuando estamos dispuestos a depender de withr. Estas cuestiones se exploran en una <a href="https://withr.r-lib.org/articles/changing-and-restoring-state.html">viñeta withr</a>.</p>
</section><section id="aislar-los-efectos-secundarios" class="level3" data-number="6.5.3"><h3 data-number="6.5.3" class="anchored" data-anchor-id="aislar-los-efectos-secundarios">
<span class="header-section-number">6.5.3</span> Aislar los efectos secundarios</h3>
<p>Crear gráficos e imprimir resultados en la consola son otras dos formas de afectar el entorno global de R. A menudo no puedes evitarlos (¡porque son importantes!), pero es una buena práctica aislarlos en funciones que <strong>sólo</strong> producen resultados. Esto también facilita que otras personas reutilicen su trabajo para nuevos usos. Por ejemplo, si separa la preparación de datos y el trazado en dos funciones, otros pueden usar su trabajo de preparación de datos (¡que suele ser la parte más difícil!) para crear nuevas visualizaciones.</p>
</section><section id="sec-code-onLoad-onAttach" class="level3" data-number="6.5.4"><h3 data-number="6.5.4" class="anchored" data-anchor-id="sec-code-onLoad-onAttach">
<span class="header-section-number">6.5.4</span> Cuando <strong>sí</strong> necesitas efectos secundarios</h3>
<p>En ocasiones, los paquetes necesitan efectos secundarios. Esto es más común si su paquete se comunica con un sistema externo; es posible que necesite realizar alguna configuración inicial cuando se carga el paquete. Para hacer eso, puede usar dos funciones especiales: <code>.onLoad()</code> y <code>.onAttach()</code>. Estos se llaman cuando el paquete se carga y adjunta. Aprenderá sobre la distinción entre los dos en <a href="dependencies-mindset-background.html#sec-dependencies-attach-vs-load" class="quarto-xref"><span>Sección 10.4</span></a>. Por ahora, siempre debes usar <code>.onLoad()</code> a menos que se indique explícitamente lo contrario.</p>
<p>Algunos usos comunes de <code>.onLoad()</code> y <code>.onAttach()</code> son:</p>
<ul>
<li>
<p>Para configurar opciones personalizadas para su paquete con <code>opciones()</code>. Para evitar conflictos con otros paquetes, asegúrese de anteponer los nombres de las opciones al nombre de su paquete. También tenga cuidado de no anular las opciones que el usuario ya haya configurado. Aquí hay una versión (altamente redactada) de la función <code>.onLoad()</code> de dplyr que establece una opción que controla los informes de progreso:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">.onLoad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">libname</span>, <span class="va">pkgname</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">op.dplyr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    dplyr.show_progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">toset</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">op.dplyr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">toset</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="va">op.dplyr</span><span class="op">[</span><span class="va">toset</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Esto permite que las funciones en dplyr usen <code>getOption("dplyr.show_progress")</code> para determinar si se muestran barras de progreso, basándose en el hecho de que ya se ha establecido un valor predeterminado sensato.</p>
</li>
</ul>
<!-- TODO: I don't think the option setting example is so great anymore. I lean towards replacement. Other possible examples of `.onLoad()` usage: Register S3 methods. Detect capabilities of the system or of other packages. --><ul>
<li>Para mostrar un mensaje informativo cuando se adjunta el paquete. Esto podría aclarar las condiciones de uso o mostrar las capacidades del paquete según las condiciones actuales del sistema. Los mensajes de inicio son un lugar donde debes usar <code>.onAttach()</code> en lugar de <code>.onLoad()</code>. Para mostrar mensajes de inicio, utilice siempre <code><a href="https://rdrr.io/r/base/message.html">packageStartupMessage()</a></code>, y no <code><a href="https://rdrr.io/r/base/message.html">message()</a></code>. (Esto permite que <code><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages()</a></code> suprima selectivamente los mensajes de inicio del paquete).</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">.onAttach</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">libname</span>, <span class="va">pkgname</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">packageStartupMessage</a></span><span class="op">(</span><span class="st">"Welcome to my package"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como puede ver en los ejemplos, <code>.onLoad()</code> y <code>.onAttach()</code> se llaman con dos argumentos: <code>libname</code> y <code>pkgname</code>. Rara vez se usan (son un vestigio de los días en que necesitabas usar <code><a href="https://rdrr.io/r/base/library.dynam.html">library.dynam()</a></code> para cargar código compilado). Proporcionan la ruta donde está instalado el paquete (la “biblioteca”) y el nombre del paquete.</p>
<p>Si usa <code>.onLoad()</code>, considere usar <code>.onUnload()</code> para limpiar cualquier efecto secundario. Por convención, <code>.onLoad()</code> y sus amigos generalmente se guardan en un archivo llamado <code>R/zzz.R</code>. (Tenga en cuenta que <code>.First.lib()</code> y <code>.Last.lib()</code> son versiones antiguas de <code>.onLoad()</code> y <code>.onUnload()</code> y ya no deben usarse).</p>
<p>Una cosa especialmente complicada de hacer en una función como <code>.onLoad()</code> o <code>.onAttach()</code> es cambiar el estado del generador de números aleatorios. Érase una vez, ggplot2 usaba <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> para decidir si mostrar un mensaje de inicio, pero solo en sesiones interactivas. Esto, a su vez, creó un rompecabezas de reproducibilidad para los usuarios que usaban <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> para sus propios fines, antes de adjuntar ggplot2 con <code><a href="https://ggplot2.tidyverse.org">library(ggplot2)</a></code> y ejecutar el código tanto de forma interactiva como no interactiva. La solución elegida fue envolver el código de inicio ofensivo dentro de <code><a href="https://withr.r-lib.org/reference/with_seed.html">withr::with_preserve_seed()</a></code>, lo que deja la semilla aleatoria del usuario tal como la encontró.</p>
</section></section><section id="controles-de-salud-constantes" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="controles-de-salud-constantes">
<span class="header-section-number">6.6</span> Controles de salud constantes</h2>
<p>A continuación se muestra una secuencia típica de llamadas cuando se utilizan devtools para el desarrollo de paquetes:</p>
<ol type="1">
<li>Edite uno o más archivos debajo de <code>R/</code>.</li>
<li>
<code>document()</code> (si ha realizado algún cambio que afecte los archivos de ayuda o NAMESPACE)</li>
<li><code>load_all()</code></li>
<li>Ejecute algunos ejemplos de forma interactiva.</li>
<li>
<code>test()</code> (o <code>test_active_file()</code>)</li>
<li><code>check()</code></li>
</ol>
<p>Una pregunta interesante es con qué frecuencia y rapidez se avanza en este ciclo de desarrollo. A menudo nos encontramos ejecutando la secuencia anterior varias veces en una hora o en un día mientras agregamos o modificamos una sola función.</p>
<p>Aquellos nuevos en el desarrollo de paquetes pueden sentirse más cómodos lanzando código R y mucho menos cómodos escribiendo y compilando documentación, simulando la construcción e instalación de paquetes, probando y ejecutando <code>R CMD check</code>. Y es parte de la naturaleza humana abrazar lo familiar y posponer lo desconocido. Esto a menudo conduce a un flujo de trabajo disfuncional en el que la secuencia completa anterior se desarrolla con poca frecuencia, tal vez una vez al mes o cada dos meses, muy lentamente y a menudo con mucho dolor:</p>
<ol type="1">
<li>Edite uno o más archivos debajo de <code>R/</code>.</li>
<li>Compile, instale y utilice el paquete. Iterar ocasionalmente con el paso anterior.</li>
<li>Escriba la documentación (una vez que el código esté “listo”).</li>
<li>Escriba pruebas (una vez que el código esté “listo”).</li>
<li>Ejecute <code>R CMD check</code> justo antes de enviarlo a CRAN o liberarlo de alguna otra manera.</li>
</ol>
<p>Ya hemos hablado sobre el valor de la retroalimentación rápida, en el contexto de <code>load_all()</code>. Pero esto también se aplica a la ejecución de <code>document()</code>, <code>test()</code> y <code>check()</code>. Hay defectos que simplemente no puedes detectar al usar <code>load_all()</code> y ejecutar algunos ejemplos interactivos que se revelan inmediatamente mediante comprobaciones más formales. Encontrar y corregir 5 errores, uno a la vez, justo después de crear cada uno, es mucho más fácil que solucionar los 5 a la vez (posiblemente interactuando entre sí), semanas o meses después de la última vez que tocó el código.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Envío a CRAN
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si planea enviar su paquete a CRAN, debe usar solo caracteres ASCII en sus archivos <code>.R</code>. En la práctica, esto significa que está limitado a los dígitos del 0 al 9, las letras minúsculas de la “a” a la “z”, las letras mayúsculas de la “A” a la “Z” y la puntuación común.</p>
<p>Pero a veces es necesario insertar una pequeña cantidad de datos de caracteres que incluyen, por ejemplo, una letra griega (µ), un carácter acentuado (ü) o un símbolo (30°). Puede utilizar cualquier carácter Unicode siempre que lo especifique en el formato especial de escape Unicode <code>"\u1234"</code>. La forma más sencilla de encontrar el punto de código correcto es utilizar <code><a href="https://rdrr.io/pkg/stringi/man/stri_escape_unicode.html">stringi::stri_escape_unicode()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"Esto es un punto •"</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Esto es un punto \u2022"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_escape_unicode.html">stri_escape_unicode</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Esto es un punto \u2022</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A veces tienes el problema opuesto. No tienes <em>intencionalmente</em> ningún carácter que no sea ASCII en tu código R, pero las comprobaciones automáticas revelan que sí los tienes.</p>
<pre><code>W  checking R files for non-ASCII characters ...
   Found the following file with non-ASCII characters:
     foo.R
   Portable packages must use only ASCII characters in their R code,
   except perhaps in comments.
   Use \uxxxx escapes for other characters.</code></pre>
<p>Los infractores más comunes son las comillas simples y dobles “rizadas” o “inteligentes” que se cuelan al copiar y pegar. Las funciones <code><a href="https://rdrr.io/r/tools/showNonASCII.html">tools::showNonASCII()</a></code> y <code>tools::showNonASCIIfile(file)</code> le ayudan a encontrar los archivos y líneas infractores.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/showNonASCII.html">showNonASCIIfile</a></span><span class="op">(</span><span class="st">"R/foo.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 666: #' If you&lt;e2&gt;&lt;80&gt;&lt;99&gt;ve copy/pasted quotes, watch out!</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Desafortunadamente no puedes usar subdirectorios dentro de <code>R/</code>. La mejor opción es utilizar un prefijo común, por ejemplo, <code>abc-*.R</code>, para indicar que un grupo de archivos está relacionado.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Consulte el <a href="https://github.com/r-lib/actions/tree/master/examples#commands-workflow">Flujo de trabajo de comandos</a> en <a href="https://github.com/%20r-lib/acciones">Acciones de GitHub para el lenguaje R</a> repositorio.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>La publicación del blog <a href="https://mikemcquaid.com/2018/06/05/robot-pedantry-human-empathy/">Robot Pedantry, Human Empathy</a> de Mike McQuaid hace un excelente trabajo al resumir los beneficios de automatizar tareas como la recodificación de código. -peinado.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script>

  // Chapter name
  const currentChapterFile = window.location.pathname.split('/').pop().replace('.html', '');

  //Deffining urls
  const originalURL = "https://github.com/hadley/r-pkgs/";
  const translationURL = "https://github.com/davidrsch/r-pkgses";

  //Deffining texts
  const edit_text = "Editar esta página";
  const issue_text = "Informar de un problema"

  //Deffining git_i
  const git_i = '<div><i class="bi bi-github"></i></div>';

  // Adding TOC if not exist
  const sidebarmargin = document.getElementById('quarto-margin-sidebar');
  const buscar_TOC = document.getElementById('TOC');

  if (!buscar_TOC) {
    const crear_TOC = document.createElement('nav');
    crear_TOC.id = 'TOC';
    crear_TOC.role = "doc-toc";
    crear_TOC.class = "toc-active";
    sidebarmargin.appendChild(crear_TOC);
  }


  // Adding original github actions
  const TOC = document.getElementById('TOC');
  const originalga = document.createElement('h2');
  originalga.textContent = "Original";
  const toc_act_O = document.createElement('div');
  toc_act_O.className = 'toc-actions';
  toc_act_O.id = 'toc-act-O';
  const act_link_O = document.createElement('div');
  act_link_O.className='action-links';
  act_link_O.id='act-link-O';
  const edit_issue_O ='<p><a href="'+originalURL+'/edit/main/'+currentChapterFile+'.Rmd" class="toc-action">'+edit_text+'</p><p><a href="'+originalURL+'/issues/new" class="toc-action">'+issue_text+'</p>';


  TOC.appendChild(originalga);
  TOC.appendChild(toc_act_O);
  toc_act_O.innerHTML += git_i;
  toc_act_O.appendChild(act_link_O);
  act_link_O.innerHTML += edit_issue_O;

  // Adding translation github actions
  const translationga = document.createElement('h2');
  translationga.textContent = "Traducción";
  const toc_act_T = document.createElement('div');
  toc_act_T.className = 'toc-actions';
  toc_act_T.id = 'toc-act-T';
  const act_link_T = document.createElement('div');
  act_link_T.className='action-links';
  act_link_T.id='act-link-T';
  const edit_issue_T ='<p><a href="'+translationURL+'/edit/main/'+currentChapterFile+'.qmd" class="toc-action">'+edit_text+'</p><p><a href="'+translationURL+'/issues/new" class="toc-action">'+issue_text+'</p>';


  TOC.appendChild(translationga);
  TOC.appendChild(toc_act_T);
  toc_act_T.innerHTML += git_i;
  toc_act_T.appendChild(act_link_T);
  act_link_T.innerHTML += edit_issue_T;


</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiado");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiado");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./package-within.html" class="pagination-link" aria-label="El paquete en el interior de su código">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">El paquete en el interior de su código</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./data.html" class="pagination-link" aria-label="Datos">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Datos</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Paquetes de R fue escrito por Hadley Wickham y Jenny Bryan</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Este libro fue creado usando <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>