<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hadley Wickham y Jenny Bryan">
<meta name="description" content="Aprenda a crear un paquete, la unidad fundamental de contenido compartible, reutilizable, y código R reproducible.">
<title>7&nbsp; Datos – Paquetes de R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./misc.html" rel="next">
<link href="./code.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6a8d939bdf32084eecd9f414bffd5650.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No se han encontrado resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script><script defer="" data-domain="r-pkgs.org" src="https://plausible.io/js/plausible.js"></script><meta name="google-site-verification" content="kphyQu6n4JhBUuoLZxnJpD9dbw9q5FLwqXb9AkI2fhU">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./code.html">Componentes de un paquete</a></li><li class="breadcrumb-item"><a href="./data.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Datos</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Buscar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Paquetes de R</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/hadley/r-pkgs/">
            Original
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/davidrsch/rpkgs-es">
            Traducción
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo lector">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">¡Bienvenidos!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Empezando</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Todo el juego</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Configuración del sistema</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Estructura y estado del paquete</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Flujos de trabajo de desarrollo fundamentales</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./package-within.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">El paquete en el interior de su código</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Componentes de un paquete</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Código R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Datos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Otros componentes</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Metadatos del paquete</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><code>DESCRIPTION</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-mindset-background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencias: mentalidad y antecedentes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-in-practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencias: en la práctica</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Licencias</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Probar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Conceptos básicos de pruebas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Diseñar su conjunto de pruebas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Técnicas de prueba avanzadas</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentación</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./man.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Documentación de la función</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vignettes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Viñetas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other-markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Otros archivos markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Sitio web</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Mantenimiento y distribución</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software-development-practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Prácticas de desarrollo de software</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lifecycle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Ciclo de vida</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Subiendo a CRAN</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Apéndices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-CMD-check.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title"><code>R CMD check</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
<li>
<a href="#sec-data-data" id="toc-sec-data-data" class="nav-link active" data-scroll-target="#sec-data-data"><span class="header-section-number">7.1</span> Datos exportados</a>
  <ul class="collapse">
<li><a href="#sec-data-data-raw" id="toc-sec-data-data-raw" class="nav-link" data-scroll-target="#sec-data-data-raw"><span class="header-section-number">7.1.1</span> Preservar la historia del origen de los datos del paquete</a></li>
  <li><a href="#sec-documenting-data" id="toc-sec-documenting-data" class="nav-link" data-scroll-target="#sec-documenting-data"><span class="header-section-number">7.1.2</span> Documentar conjuntos de datos</a></li>
  <li><a href="#sec-data-non-ascii" id="toc-sec-data-non-ascii" class="nav-link" data-scroll-target="#sec-data-non-ascii"><span class="header-section-number">7.1.3</span> Caracteres no ASCII en datos</a></li>
  </ul>
</li>
  <li><a href="#sec-data-sysdata" id="toc-sec-data-sysdata" class="nav-link" data-scroll-target="#sec-data-sysdata"><span class="header-section-number">7.2</span> Datos internos</a></li>
  <li>
<a href="#sec-data-extdata" id="toc-sec-data-extdata" class="nav-link" data-scroll-target="#sec-data-extdata"><span class="header-section-number">7.3</span> Archivo de datos sin procesar</a>
  <ul class="collapse">
<li><a href="#sec-data-system-file" id="toc-sec-data-system-file" class="nav-link" data-scroll-target="#sec-data-system-file"><span class="header-section-number">7.3.1</span> Rutas de archivos</a></li>
  <li><a href="#sec-data-example-path-helper" id="toc-sec-data-example-path-helper" class="nav-link" data-scroll-target="#sec-data-example-path-helper"><span class="header-section-number">7.3.2</span> <code>pkg_example()</code> ayudantes de camino</a></li>
  </ul>
</li>
  <li><a href="#sec-data-state" id="toc-sec-data-state" class="nav-link" data-scroll-target="#sec-data-state"><span class="header-section-number">7.4</span> Estado interno</a></li>
  <li><a href="#sec-data-persistent" id="toc-sec-data-persistent" class="nav-link" data-scroll-target="#sec-data-persistent"><span class="header-section-number">7.5</span> Datos de usuario persistentes</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./code.html">Componentes de un paquete</a></li><li class="breadcrumb-item"><a href="./data.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Datos</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-data" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Datos</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>A menudo resulta útil incluir datos en un paquete. Si el objetivo principal de un paquete es distribuir funciones útiles, los conjuntos de datos de ejemplo facilitan la redacción de documentación excelente. Estos conjuntos de datos se pueden crear a mano para proporcionar casos de uso atractivos para las funciones del paquete. A continuación se muestran algunos ejemplos de este tipo de datos de paquete:</p>
<ul>
<li>
<a href="https://tidyr.tidyverse.org/reference/index.html#data">tidyr</a>: <code>billboard</code> (ranking de canciones), <code>who</code> (datos de tuberculosis de la Organización Mundial de la Salud)</li>
<li>
<a href="https://dplyr.tidyverse.org/reference/index.html#data">dplyr</a>: <code>starwars</code> (personajes de la guerra de las galaxias), <code>storms</code> (huellas de tormenta)</li>
</ul>
<p>En el otro extremo, algunos paquetes existen únicamente con el fin de distribuir datos, junto con su documentación. A veces se les llama “paquetes de datos”. Un paquete de datos puede ser una buena forma de compartir datos de ejemplo entre varios paquetes. También es una técnica útil para obtener archivos estáticos relativamente grandes de un paquete más orientado a funciones, que podría requerir actualizaciones más frecuentes. A continuación se muestran algunos ejemplos de paquetes de datos:</p>
<ul>
<li><a href="https://nycflights13.tidyverse.org">nycflights13</a></li>
<li>
<a href="http://hadley.github.io/babynames/">babyname</a><a href="https://github.com/hadley/babynames">s</a>
</li>
</ul>
<p>Por último, muchos paquetes se benefician de tener datos internos que se utilizan para fines internos, pero que no están expuestos directamente a los usuarios del paquete.</p>
<p>En este capítulo describimos mecanismos útiles para incluir datos en su paquete. Los detalles prácticos difieren según quién necesita acceso a los datos, con qué frecuencia cambian y qué harán con ellos:</p>
<ul>
<li><p>Si desea almacenar objetos R y ponerlos a disposición del usuario, colóquelos en <code>datos/</code>. Este es el mejor lugar para colocar conjuntos de datos de ejemplo. Todos los ejemplos concretos anteriores para datos en un paquete y datos como paquete utilizan este mecanismo. Mira <a href="#sec-data-data" class="quarto-xref"><span>Sección 7.1</span></a>.</p></li>
<li><p>Si desea almacenar objetos R para su propio uso como desarrollador, colóquelos en <code>R/sysdata.rda</code>. Este es el mejor lugar para colocar los datos internos que sus funciones necesitan. Mira <a href="#sec-data-sysdata" class="quarto-xref"><span>Sección 7.2</span></a>.</p></li>
<li><p>Si desea almacenar datos en algún formato sin procesar, no específico de R y ponerlos a disposición del usuario, colóquelos en <code>inst/extdata/</code>. Por ejemplo, readr y readxl utilizan este mecanismo para proporcionar una colección de archivos delimitados y libros de Excel, respectivamente. Mira <a href="#sec-data-extdata" class="quarto-xref"><span>Sección 7.3</span></a>.</p></li>
<li><p>Si desea almacenar datos dinámicos que reflejen el estado interno de su paquete dentro de una única sesión de R, utilice un entorno. Esta técnica no es tan común ni tan conocida como las anteriores, pero puede resultar muy útil en situaciones concretas. Mira <a href="#sec-data-state" class="quarto-xref"><span>Sección 7.4</span></a>.</p></li>
<li><p>Si desea almacenar datos de forma persistente en sesiones de R, como configuración o datos específicos del usuario, utilice una de las ubicaciones autorizadas oficialmente. Mira <a href="#sec-data-persistent" class="quarto-xref"><span>Sección 7.5</span></a>.</p></li>
</ul>
<section id="sec-data-data" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="sec-data-data">
<span class="header-section-number">7.1</span> Datos exportados</h2>
<p>La ubicación más común para los datos del paquete es (¡sorpresa!) <code>data/</code>. Recomendamos que cada archivo en este directorio sea un archivo <code>.rda</code> creado por <code><a href="https://rdrr.io/r/base/save.html">save()</a></code> que contenga un único objeto R, con el mismo nombre que el archivo. La forma más sencilla de lograrlo es utilizar <code><a href="https://usethis.r-lib.org/reference/use_data.html">usethis::use_data()</a></code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_pkg_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span><span class="op">(</span><span class="va">my_pkg_data</span><span class="op">)</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Imaginemos que estamos trabajando en un paquete llamado “pkg”. El fragmento anterior crea <code>data/my_pkg_data.rda</code> dentro del código fuente del paquete pkg y agrega <code>LazyData: true</code> en su <code>DESCRIPCIÓN</code>. Esto hace que el objeto R <code>my_pkg_data</code> esté disponible para los usuarios de pkg a través de <code>pkg::my_pkg_data</code> o, después de adjuntar pkg con <code><a href="https://rdrr.io/r/base/library.html">library(pkg)</a></code>, como <code>my_pkg_data</code>.</p>
<p>El fragmento anterior es algo que el mantenedor ejecuta una vez (o cada vez que necesita actualizar <code>my_pkg_data</code>). Este es el código de flujo de trabajo y <strong>no</strong> debería aparecer en el directorio <code>R/</code> del paquete fuente. (Hablaremos sobre un lugar adecuado para guardar este código a continuación). Para conjuntos de datos más grandes, es posible que desees experimentar con la configuración de compresión, que está bajo el control del argumento “comprimir”. El valor predeterminado es “bzip2”, pero a veces “gzip” o “xz” pueden crear archivos más pequeños.</p>
<p>Es posible utilizar otros tipos de archivos debajo de <code>data/</code>, pero no lo recomendamos porque los archivos <code>.rda</code> ya son rápidos, pequeños y explícitos. Las otras posibilidades se describen en la documentación de <code><a href="https://rdrr.io/r/utils/data.html">utils::data()</a></code> y en <a href="https://rstudio.github.io/r-manuals/r-exts/Creating-R-packages.%20html#data-in-packages">Datos en paquetes</a> de Escritura de extensiones R. En términos de consejos para los autores de paquetes, el tema de ayuda para <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> parece hacer implícitamente las mismas recomendaciones que hacemos anteriormente:</p>
<ul>
<li>Almacene un objeto R en cada archivo <code>data/*.rda</code>
</li>
<li>Utilice el mismo nombre para ese objeto y su archivo <code>.rda</code>
</li>
<li>Utilice carga diferida, de forma predeterminada</li>
</ul>
<p>Si la <code>DESCRIPTION</code> contiene <code>LazyData: true</code>, los conjuntos de datos se cargarán de forma diferida. Esto significa que no ocuparán memoria hasta que los uses. El siguiente ejemplo muestra el uso de la memoria antes y después de cargar el paquete nycflights13. Puede ver que el uso de la memoria no cambia significativamente hasta que inspecciona el conjunto de datos de <code>flights</code> almacenados dentro del paquete.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 74.67 MB</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span>
<span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 76.40 MB</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span></span>
<span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 117.09 MB</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Le recomendamos que incluya <code>LazyData: true</code> en su <code>DESCRIPTION</code> si envía archivos <code>.rda</code> debajo de <code>data/</code>. Si utiliza <code>use_data()</code> para crear dichos conjuntos de datos, automáticamente realizará esta modificación en <code>DESCRIPTION</code> por usted.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Advertencia
</div>
</div>
<div class="callout-body-container callout-body">
<p>Es importante tener en cuenta que los conjuntos de datos cargados de forma diferida <strong>no</strong> necesitan estar precargados con <code><a href="https://rdrr.io/r/utils/data.html">utils::data()</a></code> y, de hecho, normalmente es mejor evitar hacerlo. Arriba, una vez que hicimos <code><a href="https://github.com/hadley/nycflights13">library(nycflights13)</a></code>, pudimos acceder inmediatamente a <code>flights</code>. No hay llamada a <code>datos(flights)</code>, porque no es necesario.</p>
<p>Hay desventajas específicas de las llamadas <code>data(some_pkg_data)</code> que admiten una política de usar <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> solo cuando es realmente necesario, es decir, para conjuntos de datos que de otro modo no estarían disponibles:</p>
<ul>
<li>De forma predeterminada, <code>data(some_pkg_data)</code> crea uno o más objetos en el espacio de trabajo global del usuario. Existe la posibilidad de sobrescribir silenciosamente objetos preexistentes con nuevos valores.</li>
<li>Tampoco hay garantía de que <code>data(foo)</code> cree exactamente un objeto llamado “foo”. Podría crear más de un objeto y/u objetos con nombres totalmente diferentes.</li>
</ul>
<p>Un argumento a favor de llamadas como <code>data(some_pkg_data, package = "pkg")</code> que no son estrictamente necesarias es que aclara qué paquete proporciona <code>some_pkg_data</code>. Preferimos alternativas que no modifiquen el espacio de trabajo global, como un comentario de código o el acceso a través de <code>pkg::some_pkg_data</code>.</p>
<p>Este extracto de la documentación de <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> transmite que es en gran medida de importancia histórica:</p>
<blockquote class="blockquote">
<p><code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> Originalmente estaba destinado a permitir a los usuarios cargar conjuntos de datos desde paquetes para usarlos en sus ejemplos y, como tal, cargaba los conjuntos de datos en el espacio de trabajo. <code>.GlobalEnv</code>. Esto evitó tener grandes conjuntos de datos en la memoria cuando no estaban en uso: esa necesidad ha sido reemplazada casi por completo por la carga diferida de conjuntos de datos.</p>
</blockquote>
</div>
</div>
<section id="sec-data-data-raw" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="sec-data-data-raw">
<span class="header-section-number">7.1.1</span> Preservar la historia del origen de los datos del paquete</h3>
<p>A menudo, los datos que incluye en <code>data/</code> son una versión limpia de datos sin procesar que ha recopilado de otro lugar. Recomendamos encarecidamente tomarse el tiempo para incluir el código utilizado para hacer esto en la versión fuente de su paquete. Esto le facilita actualizar o reproducir su versión de los datos. Este script de creación de datos también es un lugar natural para dejar comentarios sobre propiedades importantes de los datos, es decir, qué características son importantes para el uso posterior en la documentación del paquete.</p>
<p>Le sugerimos que mantenga este código en uno o más archivos <code>.R</code> debajo de <code>data-raw/</code>. No lo desea en la versión incluida de su paquete, por lo que esta carpeta debe aparecer en <code>.Rbuildignore</code>. usethis tiene una función conveniente que se puede llamar cuando adopta por primera vez la práctica <code>data-raw/</code> o cuando agrega un archivo <code>.R</code> adicional a la carpeta:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data_raw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data_raw</a></span><span class="op">(</span><span class="st">"my_pkg_data"</span><span class="op">)</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>use_data_raw()</code> crea la carpeta <code>data-raw/</code> y la enumera en <code>.Rbuildignore</code>. Un script típico en <code>data-raw/</code> incluye código para preparar un conjunto de datos y termina con una llamada a <code>use_data()</code>.</p>
<p>Todos estos paquetes de datos utilizan el enfoque recomendado aquí para <code>data-raw/</code>:</p>
<ul>
<li><a href="https://github.com/hadley/babynames">babynames</a></li>
<li><a href="https://github.com/hadley/nycflights13">nycflights13</a></li>
<li><a href="https://github.com/jennybc/gapminder">gapminder</a></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>ggplot2: Un cuento con moraleja
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tenemos una confesión que hacer: los orígenes de muchos de los conjuntos de datos de ejemplo de ggplot2 se han perdido en las arenas del tiempo. En el gran esquema de las cosas, esto no es un gran problema, pero el mantenimiento es ciertamente más placentero cuando los activos de un paquete pueden reconstruirse <em>de novo</em> y actualizarse fácilmente según sea necesario.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Advertencia</span>Envío a CRAN
</div>
</div>
<div class="callout-body-container callout-body">
<p>Generalmente, los datos del paquete deben ser más pequeños que un megabyte; si son más grandes, deberá solicitar una exención. Esto suele ser más fácil de hacer si los datos están en su propio paquete y no se actualizarán con frecuencia, es decir, si lo aborda como un “paquete de datos” dedicado. Como referencia, los paquetes babynames y nycflights se han lanzado una vez cada uno o dos años, desde que aparecieron por primera vez en CRAN.</p>
<p>Si tiene problemas de tamaño, debe ser intencional con respecto al método de compresión de datos. El valor predeterminado para <code>usethis::use_data(compress =)</code> es “bzip2”, mientras que el valor predeterminado para <code>save(compress =)</code> es (efectivamente) “gzip”, y “xz” es otra opción válida.</p>
<p>Tendrás que experimentar con diferentes métodos de compresión y tomar esta decisión de forma empírica. <code>tools::resaveRdaFiles("data/")</code> automatiza este proceso, pero no le informa qué método de compresión se eligió. Puede aprender esto después del hecho con <code><a href="https://rdrr.io/r/tools/checkRdaFiles.html">tools::checkRdaFiles()</a></code>. Suponiendo que está realizando un seguimiento del código para generar sus datos, sería prudente actualizar la llamada <code>use_data(compress =)</code> correspondiente debajo de <code>data-raw/</code> y volver a generar el <code>.rda</code> limpiamente.</p>
</div>
</div>
</section><section id="sec-documenting-data" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="sec-documenting-data">
<span class="header-section-number">7.1.2</span> Documentar conjuntos de datos</h3>
<p>Los objetos en <code>data/</code> siempre se exportan efectivamente (utilizan un mecanismo ligeramente diferente al de <code>NAMESPACE</code> pero los detalles no son importantes). Esto significa que deben estar documentados. Documentar datos es como documentar una función con algunas diferencias menores. En lugar de documentar los datos directamente, documenta el nombre del conjunto de datos y lo guarda en <code>R/</code>. Por ejemplo, el bloque roxygen2 utilizado para documentar los datos <code>quién</code>(<code>who</code>) en tidyr se guarda en <code>R/data.R</code> y se parece a esto:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' Datos sobre tuberculosis de la Organización Mundial de la Salud</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Un subconjunto de datos de un Informe de la Tuberculosis Global de la </span></span>
<span><span class="co">#' Organización Mundial de la Salud ...</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @format ## `who`</span></span>
<span><span class="co">#' Un marco de datos con 7240 filas y 60 columnas:</span></span>
<span><span class="co">#' \describe{</span></span>
<span><span class="co">#'   \item{country}{Country name}</span></span>
<span><span class="co">#'   \item{iso2, iso3}{2 &amp; 3 letter ISO country codes}</span></span>
<span><span class="co">#'   \item{year}{Year}</span></span>
<span><span class="co">#'   ...</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#' @source &lt;https://www.who.int/teams/global-tuberculosis-programme/data&gt;</span></span>
<span><span class="st">"who"</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Hay dos etiquetas roxygen que son especialmente importantes para documentar conjuntos de datos:</p>
<ul>
<li><p><code>@format</code> ofrece una visión general del conjunto de datos. Para los marcos de datos, debe incluir una lista de definiciones que describa cada variable. Generalmente es una buena idea describir aquí las unidades de las variables.</p></li>
<li><p><code>@source</code> proporciona detalles de dónde obtuvo los datos, a menudo una URL.</p></li>
</ul>
<p>Nunca <code>@export</code> un conjunto de datos.</p>
</section><section id="sec-data-non-ascii" class="level3" data-number="7.1.3"><h3 data-number="7.1.3" class="anchored" data-anchor-id="sec-data-non-ascii">
<span class="header-section-number">7.1.3</span> Caracteres no ASCII en datos</h3>
<p>Los objetos R que almacena en <code>data/*.rda</code> a menudo contienen cadenas, siendo el ejemplo más común las columnas de caracteres en un marco de datos. Si puede restringir estas cadenas para que utilicen únicamente caracteres ASCII, ciertamente simplificará las cosas. Pero, por supuesto, existen muchas razones legítimas por las que los datos del paquete pueden incluir caracteres que no son ASCII.</p>
<p>En ese caso, le recomendamos que adopte el <a href="http://utf8everywhere.org">manifiesto UTF-8 Everywhere</a> y utilice la codificación UTF-8. El archivo <code>DESCRIPCIÓN</code> colocado por <code><a href="https://usethis.r-lib.org/reference/create_package.html">usethis::create_package()</a></code> siempre incluye <code>Encoding: UTF-8</code>, por lo que, de forma predeterminada, un paquete producido por devtools ya anuncia que usará UTF-8.</p>
<p>Asegurarse de que las cadenas incrustadas en los datos de su paquete tengan la codificación deseada es algo que debe lograr en su código de preparación de datos, es decir, en los scripts de R debajo de <code>data-raw/</code>. Puede usar <code><a href="https://rdrr.io/r/base/Encoding.html">Encoding()</a></code> para conocer la codificación actual de los elementos en un vector de caracteres y funciones como <code><a href="https://rdrr.io/r/base/Encoding.html">enc2utf8()</a></code> o <code><a href="https://rdrr.io/r/base/iconv.html">iconv()</a></code> para convertir entre codificaciones.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Advertencia</span>Envío a CRAN
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si tiene cadenas codificadas en UTF-8 en los datos de su paquete, puede ver esto desde <code>R CMD check</code>:</p>
<pre><code>-   checking data for non-ASCII characters ... NOTE
    Note: found 352 marked UTF-8 strings</code></pre>
<p>Esta <code>NOTA</code> es verdaderamente informativa. No requiere ninguna acción por su parte. Siempre que realmente desee tener cadenas UTF-8 en los datos de su paquete, todo está bien.</p>
<p>Irónicamente, esta <code>NOTA</code> en realidad es suprimida por <code>R CMD check --as-cran</code>, a pesar de que esta nota aparece en los resultados de la verificación una vez que un paquete está en CRAN (lo que implica que CRAN no necesariamente verifica con <code>--as-cran</code>). De forma predeterminada, <code><a href="https://devtools.r-lib.org/reference/check.html">devtools::check()</a></code> establece el indicador <code>--as-cran</code> y por lo tanto no transmite esta <code>NOTA</code>. Pero puedes sacarlo a la superficie con <code>check(cran = FALSE, env_vars = c("_R_CHECK_PACKAGE_DATASETS_SUPPRESS_NOTES_" = "false"))</code>.</p>
</div>
</div>
<!-- TODO: Offer some advice for those who have non-ASCII strings in their package and it is a surprise (so, it's not intentional). The best resource I have found so far for this is `tools:::.check_package_datasets()`. Perhaps devtools should get a function that does a ground-up implementation of such a search for non-ASCII strings. -->
<!-- https://github.com/wch/r-source/blob/f6737799b169710006b040f72f9abc5e09180229/src/library/tools/R/QC.R#L4672 -->
</section></section><section id="sec-data-sysdata" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="sec-data-sysdata">
<span class="header-section-number">7.2</span> Datos internos</h2>
<p>A veces, las funciones de su paquete necesitan acceso a datos precalculados. Si coloca estos objetos en <code>data/</code>, también estarán disponibles para los usuarios del paquete, lo cual no es apropiado. A veces, los objetos que necesitas son lo suficientemente pequeños y simples como para poder definirlos con <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> o <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> en el código debajo de <code>R/</code>, tal vez en <code>R/data.R</code>. Los objetos más grandes o más complicados deben almacenarse en los datos internos de su paquete en <code>R/sysdata.rda</code>, para que se carguen de forma diferida según demanda.</p>
<p>A continuación se muestran algunos ejemplos de datos de paquetes internos:</p>
<ul>
<li>Dos paquetes relacionados con el color, <a href="https://github.com/cwickham/munsell">munsell</a> y <a href="https://cran.r-project.org/web/packages/dichromat/index.html">dichromat</a>, utilice <code>R/sysdata.rda</code> para almacenar grandes tablas de datos de color.</li>
<li>
<a href="https://github.com/tidyverse/googledrive">googledrive</a> y <a href="https://github.com/tidyverse/googlesheets4">googlesheets4</a> envuelva las API de Google Drive y Google Sheets, respectivamente. Ambos usan <code>R/sysdata.rda</code> para almacenar datos derivados del llamado <a href="https://developers.google.com/discovery/v1/reference/apis">Documento de descubrimiento</a> que “describe la superficie de la API, cómo acceder a la API y cómo se estructuran las solicitudes y respuestas de la API”.</li>
</ul>
<!-- Another example I noted: readr + data-raw/date-symbols.R + date_symbols --><p>La forma más sencilla de crear <code>R/sysdata.rda</code> es utilizar <code>usethis::use_data(internal = TRUE)</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">internal_this</span> <span class="op">&lt;-</span> <span class="va">...</span></span>
<span><span class="va">internal_that</span> <span class="op">&lt;-</span> <span class="va">...</span></span>
<span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span><span class="op">(</span><span class="va">internal_this</span>, <span class="va">internal_that</span>, internal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A diferencia de <code>data/</code>, donde se utiliza un archivo <code>.rda</code> por objeto de datos exportado, se almacenan todos los objetos de datos internos juntos en un único archivo. <code>R/sysdata.rda</code>.</p>
<p>Imaginemos que estamos trabajando en un paquete llamado “pkg”. El fragmento anterior crea <code>R/sysdata.rda</code> dentro del código fuente del paquete pkg. Esto hace que los objetos <code>internal_this</code> e <code>internal_that</code> estén disponibles para su uso dentro de las funciones definidas debajo de <code>R/</code> y en las pruebas. Durante el desarrollo interactivo, <code>internal_this</code> e <code>internal_that</code> están disponibles después de una llamada a <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code>, como una función interna.</p>
<p>Gran parte de los consejos dados para los datos externos también se aplican a los datos internos:</p>
<ul>
<li>Es una buena idea almacenar el código que genera sus objetos de datos internos individuales, así como la llamada <code>use_data()</code> que los escribe todos en <code>R/sysdata.rda</code>. Este es el código de flujo de trabajo que pertenece debajo de <code>data-raw/</code>, no debajo de <code>R/</code>.</li>
<li>
<code><a href="https://usethis.r-lib.org/reference/use_data.html">usethis::use_data_raw()</a></code> se puede utilizar para iniciar el uso de <code>data-raw/</code> o para iniciar un nuevo script <code>.R</code> allí.</li>
<li>Si su paquete es demasiado grande, experimente con diferentes valores de <code>compress</code> en <code>use_data(internal = TRUE)</code>.</li>
</ul>
<p>También existen distinciones clave en las que difiere el manejo de datos internos y externos:</p>
<ul>
<li>Los objetos en <code>R/sysdata.rda</code> no se exportan (no deberían exportarse), por lo que no es necesario documentarlos.</li>
<li>El campo <code>LazyData</code> en el paquete <code>DESCRIPTION</code> no tiene ningún impacto en <code>R/sysdata.rda</code> pero se refiere estrictamente a los datos exportados debajo de <code>data/</code>. Los datos internos siempre se cargan de forma diferida.</li>
</ul></section><section id="sec-data-extdata" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="sec-data-extdata">
<span class="header-section-number">7.3</span> Archivo de datos sin procesar</h2>
<p>Si desea mostrar ejemplos de carga/análisis de datos sin procesar, coloque los archivos originales en <code>inst/extdata/</code>. Cuando se instala el paquete, todos los archivos (y carpetas) en <code>inst/</code> se mueven hacia arriba un nivel hasta el directorio de nivel superior, por lo que no pueden tener nombres que entren en conflicto con las partes estándar de un paquete R, como <code>R/</code> o <code>DESCRIPTION</code> . Los archivos debajo de <code>inst/extdata/</code> en el paquete fuente se ubicarán debajo de <code>extdata/</code> en el paquete instalado correspondiente. Es posible que desee volver a visitar <a href="structure.html#fig-package-files" class="quarto-xref">Figura&nbsp;<span>3.1</span></a> para revisar la estructura de archivos para los diferentes estados del paquete.</p>
<p>La razón principal para incluir dichos archivos es cuando una parte clave de la funcionalidad de un paquete es actuar sobre un archivo externo. Ejemplos de dichos paquetes incluyen:</p>
<ul>
<li>readr, que lee datos rectangulares de archivos delimitados</li>
<li>readxl, que lee datos rectangulares de hojas de cálculo de Excel</li>
<li>xml2, que puede leer XML y HTML desde un archivo</li>
<li>archive, que puede leer archivos comprimidos, como tar o ZIP</li>
</ul>
<p>Todos estos paquetes tienen uno o más archivos de ejemplo debajo de <code>inst/extdata/</code>, que son útiles para escribir documentación y pruebas.</p>
<p>También es común que los paquetes de datos proporcionen, por ejemplo, una versión csv de los datos del paquete que también se proporciona como un objeto R. Ejemplos de dichos paquetes incluyen:</p>
<ul>
<li>palmerpenguins: <code>penguins</code> y <code>penguins_raw</code> también se representan como <code>extdata/penguins.csv</code> y <code>extdata/penguins_raw.csv</code>
</li>
<li>gapminder: <code>gapminder</code>, <code>continent_colors</code>, y <code>country_colors</code> también se representan como <code>extdata/gapminder.tsv</code>, <code>extdata/continent-colors.tsv</code>, y <code>extdata/country-colors.tsv</code>
</li>
</ul>
<p>Esto tiene dos beneficios: en primer lugar, les da a los profesores y otros expositores más con qué trabajar una vez que deciden utilizar un conjunto de datos específico. Si has empezado a enseñar R con <code>palmerpenguins::penguins</code> o <code>gapminder::gapminder</code> y desea introducir la importación de datos, puede ser útil para los estudiantes si utilizan por primera vez un comando nuevo, como <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv()</a></code> o <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code>, se aplica a un conjunto de datos familiar. Tienen una intuición preexistente sobre el resultado esperado. Finalmente, si los datos del paquete evolucionan con el tiempo, tener un csv u otra representación de texto sin formato en el paquete fuente puede hacer que sea más fácil ver qué ha cambiado.</p>
<section id="sec-data-system-file" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="sec-data-system-file">
<span class="header-section-number">7.3.1</span> Rutas de archivos</h3>
<p>La ruta a un archivo de paquete que se encuentra debajo de <code>extdata/</code> depende claramente del entorno local, es decir, depende de dónde se encuentran los paquetes instalados en esa máquina. La función base <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> puede informar la ruta completa a los archivos distribuidos con un paquete R. También puede resultar útil <em>enumerar</em> los archivos distribuidos con un paquete R.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"readxl"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "clippy.xls"    "clippy.xlsx"   "datasets.xls"  "datasets.xlsx"</span></span>
<span><span class="co">#&gt;  [5] "deaths.xls"    "deaths.xlsx"   "geometry.xls"  "geometry.xlsx"</span></span>
<span><span class="co">#&gt;  [9] "type-me.xls"   "type-me.xlsx"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"clippy.xlsx"</span>, package <span class="op">=</span> <span class="st">"readxl"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/rpkgs-es/rpkgs-es/renv/library/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu/readxl/extdata/clippy.xlsx"</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Estas rutas de archivos presentan otro dilema en el flujo de trabajo: cuando estás desarrollando tu paquete, interactúas con él en su formato fuente, pero tus usuarios interactúan con él como un paquete instalado. Afortunadamente, devtools proporciona una corrección para <code><a href="https://rdrr.io/r/base/system.file.html">base::system.file()</a></code> que se activa mediante <code>load_all()</code>. Esto realiza llamadas interactivas a <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> desde el entorno global y las llamadas desde dentro del espacio de nombres del paquete “simplemente funcionan”.</p>
<p>Tenga en cuenta que, de forma predeterminada, <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> devuelve la cadena vacía, no un error, para un archivo que no existe.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"I_do_not_exist.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] ""</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Si desea forzar un error en este caso, especifique <code>mustWork = TRUE</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"I_do_not_exist.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in system.file("extdata", "I_do_not_exist.csv", package = "readr", : no file found</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>El <a href="https://fs.r-lib.org">paquete fs</a> ofrece <code><a href="https://fs.r-lib.org/reference/path_package.html">fs::path_package()</a></code>. Esto es esencialmente <code><a href="https://rdrr.io/r/base/system.file.html">base::system.file()</a></code> con algunas características adicionales que consideramos ventajosas, siempre que sea razonable depender de fs:</p>
<ul>
<li>Se produce un error si la ruta del archivo no existe.</li>
<li>Genera errores distintos cuando el paquete no existe versus cuando el archivo no existe dentro del paquete.</li>
<li>Durante el desarrollo, funciona para llamadas interactivas, llamadas desde dentro del espacio de nombres del paquete cargado e incluso para llamadas que se originan en dependencias.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_package.html">path_package</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"idonotexist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Can't find package `idonotexist` in library locations:</span></span>
<span><span class="co">#&gt;   - '/home/runner/work/rpkgs-es/rpkgs-es/renv/library/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu'</span></span>
<span><span class="co">#&gt;   - '/home/runner/.cache/R/renv/sandbox/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu/3df92652'</span></span>
<span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_package.html">path_package</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"I_do_not_exist.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: File(s) '/home/runner/work/rpkgs-es/rpkgs-es/renv/library/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu/readr/extdata/I_do_not_exist.csv' do not exist</span></span>
<span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_package.html">path_package</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"chickens.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; /home/runner/work/rpkgs-es/rpkgs-es/renv/library/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu/readr/extdata/chickens.csv</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<!--

```
during development               after installation                             

/path/to/local/package           /path/to/some/installed/package
├── DESCRIPTION                  ├── DESCRIPTION
├── ...                          ├── ...
├── inst                         └── some-installed-file.txt
│   └── some-installed-file.txt  
└── ...
```

`fs::path_package("some-installed_file.txt")` builds the correct path in both cases.

A common theme you've now encountered in multiple places is that devtools and related packages try to eliminate hard choices between having a smooth interactive development experience and arranging things correctly in your package.
-->
</section><section id="sec-data-example-path-helper" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="sec-data-example-path-helper">
<span class="header-section-number">7.3.2</span> <code>pkg_example()</code> ayudantes de camino</h3>
<p>Nos gusta ofrecer funciones convenientes que faciliten el acceso a los archivos de ejemplo. Estos son simplemente envoltorios fáciles de usar alrededor de <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> o <code><a href="https://fs.r-lib.org/reference/path_package.html">fs::path_package()</a></code>, pero pueden tener características adicionales, como la capacidad de enumerar los archivos de ejemplo. Aquí está la definición y algunos usos de <code><a href="https://readxl.tidyverse.org/reference/readxl_example.html">readxl::readxl_example()</a></code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">readxl_example</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"readxl"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="va">path</span>, package <span class="op">=</span> <span class="st">"readxl"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "clippy.xls"    "clippy.xlsx"   "datasets.xls"  "datasets.xlsx"</span></span>
<span><span class="co">#&gt;  [5] "deaths.xls"    "deaths.xlsx"   "geometry.xls"  "geometry.xlsx"</span></span>
<span><span class="co">#&gt;  [9] "type-me.xls"   "type-me.xlsx"</span></span>
<span></span>
<span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"clippy.xlsx"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/renv/cache/v5/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu/readxl/1.4.3/8cf9c239b96df1bbb133b74aef77ad0a/readxl/extdata/clippy.xlsx"</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="sec-data-state" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="sec-data-state">
<span class="header-section-number">7.4</span> Estado interno</h2>
<p>A veces hay información a la que varias funciones de su paquete necesitan acceder:</p>
<ul>
<li>Debe determinarse en el momento de la carga (o incluso más tarde), no en el momento de la compilación. Incluso podría ser dinámico.</li>
<li>No tiene sentido pasarlo mediante un argumento de función. A menudo se trata de algún detalle oscuro que el usuario ni siquiera debería conocer.</li>
</ul>
<p>Una excelente manera de administrar dichos datos es utilizar un <em>entorno</em>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Este entorno debe crearse en el momento de la compilación, pero puede completarlo con valores después de que se haya cargado el paquete y actualizar esos valores en el transcurso de una sesión de R. Esto funciona porque los entornos tienen una semántica de referencia (mientras que los objetos R más comunes, como vectores atómicos, listas o marcos de datos, tienen una semántica de valores).</p>
<p>Considere un paquete que pueda almacenar las letras o números favoritos del usuario. Podrías comenzar con un código como este en el archivo siguiente <code>R/</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">favorite_letters</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#' Reportar mis letras favoritas</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">mfl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">favorite_letters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Cambiar mis letras favoritas</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">set_mfl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span> <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">24</span><span class="op">:</span><span class="fl">26</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">old</span> <span class="op">&lt;-</span> <span class="va">favorite_letters</span></span>
<span>  <span class="va">favorite_letters</span> <span class="op">&lt;&lt;-</span> <span class="va">l</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>favorite_letters</code> se inicializa en (“a”, “b”, “c”) cuando se crea el paquete. Luego, el usuario puede inspeccionar <code>favorite_letters</code> con <code>mfl()</code>, momento en el cual probablemente querrá registrar <em>sus</em> letras favoritas con <code>set_mfl()</code>. Tenga en cuenta que hemos utilizado el operador de superasignación <code>&lt;&lt;-</code> en <code>set_mfl()</code> con la esperanza de que llegue al entorno del paquete y modifique el objeto de datos interno <code>favorite_letters</code>. Pero una llamada a <code>set_mfl()</code> falla así:<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mfl</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c"</span></span>
<span></span>
<span><span class="fu">set_mfl</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"j"</span>, <span class="st">"f"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in set_mfl() : </span></span>
<span><span class="co">#&gt;   cannot change value of locked binding for 'favorite_letters'</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Debido a que <code>favorite_letters</code> es un vector de caracteres normal, la modificación requiere hacer una copia y volver a vincular el nombre <code>favorite_letters</code> a este nuevo valor. Y eso es lo que no está permitido: no se puede cambiar el enlace de los objetos en el espacio de nombres del paquete (bueno, al menos no sin esforzarse más). Definir <code>favorite_letters</code> de esta manera solo funciona si nunca necesitarás modificarlo.</p>
<p>Sin embargo, si mantenemos el estado dentro de un entorno de paquete interno, <strong>podemos</strong> modificar los objetos contenidos en el entorno (e incluso agregar objetos completamente nuevos). Aquí hay una implementación alternativa que utiliza un entorno interno llamado “el”.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">the</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">new.env</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">emptyenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">the</span><span class="op">$</span><span class="va">favorite_letters</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#' Reportar mis letras favoritas</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">mfl2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">the</span><span class="op">$</span><span class="va">favorite_letters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Cambiar mis letras favoritas</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">set_mfl2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span> <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">24</span><span class="op">:</span><span class="fl">26</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">old</span> <span class="op">&lt;-</span> <span class="va">the</span><span class="op">$</span><span class="va">favorite_letters</span></span>
<span>  <span class="va">the</span><span class="op">$</span><span class="va">favorite_letters</span> <span class="op">&lt;-</span> <span class="va">l</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Ahora un usuario <em>puede</em> registrar sus letras favoritas:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mfl2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c"</span></span>
<span></span>
<span><span class="fu">set_mfl2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"j"</span>, <span class="st">"f"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mfl2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "j" "f" "b"</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Tenga en cuenta que este nuevo valor para <code>the$favorite_letters</code> persiste solo durante el resto de la sesión actual de R (o hasta que el usuario llame a <code>set_mfl2()</code> nuevamente). Más precisamente, el estado alterado persiste sólo hasta la próxima vez que se carga el paquete (incluso a través de <code>load_all()</code>). En el momento de la carga, el entorno <code>the</code> se restablece a un entorno que contiene exactamente un objeto, llamado <code>favorite_letters</code>, con valor (“a”, “b”, “c”). Es como la película El día de la marmota. (Discutiremos datos más persistentes específicos de paquetes y usuarios en la siguiente sección).</p>
<p>Jim Hester presentó a nuestro grupo la ingeniosa idea de utilizar “el” como nombre de un entorno de paquete interno. Esto le permite referirse a los objetos internos de una manera muy natural, como <code>the$token</code>, que significa “<em>the</em> token”. También es importante especificar <code>parent = vacíoenv()</code> al definir un entorno interno, ya que generalmente no desea que el entorno herede de ningún otro entorno (no vacío).</p>
<p>Como se ve en el ejemplo anterior, la definición del entorno debe realizarse como una asignación de nivel superior en un archivo debajo de <code>R/</code>. (En particular, esta es una razón legítima para definir una no función en el nivel superior de un paquete; consulte <a href="code.html#sec-code-when-executed" class="quarto-xref"><span>Sección 6.4</span></a> para saber por qué esto debería ser poco común). En cuanto a dónde colocar esta definición, hay dos consideraciones:</p>
<ul>
<li><p>Defínelo antes de usarlo. Si otras llamadas de nivel superior se refieren al entorno, la definición debe aparecer primero cuando el código del paquete se ejecuta en el momento de la compilación. Es por eso que <code>R/aaa.R</code> es una opción común y segura.</p></li>
<li><p>Facilite su búsqueda más adelante cuando esté trabajando en funciones relacionadas. Si un entorno solo es utilizado por una familia de funciones, defínalo allí. Si el uso del entorno se distribuye alrededor del paquete, defínalo en un archivo con connotaciones para todo el paquete.</p></li>
</ul>
<!-- Examples where we name such an environment "the": rcmdcheck, itdepends, cpp11, gmailr, rlang, covr --><p>A continuación se muestran algunos ejemplos de cómo los paquetes utilizan un entorno interno:</p>
<ul>
<li>googledrive: Varias funciones necesitan conocer el ID del archivo del directorio de inicio del usuario actual en Google Drive. Esto requiere una llamada API (una operación relativamente costosa y propensa a errores) que produce una cadena deslumbrante de ~40 caracteres aparentemente aleatorios que solo una computadora puede amar. Sería inhumano esperar que un usuario sepa esto o lo pase a cada función. También sería ineficiente redescubrir la identificación repetidamente. En cambio, Googledrive determina el ID cuando lo necesita por primera vez y luego lo almacena en caché para su uso posterior.</li>
<li>usethis: La mayoría de las funciones necesitan conocer el proyecto activo, es decir, a qué directorio apuntar para modificar el archivo. Este suele ser el directorio de trabajo actual, pero no es un uso invariable en el que pueda confiar. Un diseño potencial es hacer posible especificar el proyecto de destino como argumento de cada función en uso. Pero esto crearía un desorden significativo en la interfaz de usuario, así como inquietud interna. En cambio, determinamos el proyecto activo en la primera necesidad, lo almacenamos en caché y proporcionamos métodos para (re)configurarlo.</li>
</ul>
<p>La publicación del blog <a href="https://trestletech.com/2013/04/package-wide-variablescache-in-r-package/">Variables de todo el paquete/Caché en paquetes R</a> ofrece un desarrollo más detallado de esta técnica.</p>
<!-- I've always felt like Hermione's beaded bag / Bag of Holding is a great analogy for this environment technique. As long as you've got this bag, you can keep whatever you like in it. Should I try to develop this? -->
</section><section id="sec-data-persistent" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="sec-data-persistent">
<span class="header-section-number">7.5</span> Datos de usuario persistentes</h2>
<p>A veces hay datos que obtiene su paquete, en nombre de sí mismo o del usuario, que deberían persistir <em>incluso entre sesiones de R</em>. Esta es nuestra última forma y probablemente la menos común de almacenar datos de paquetes. Para que los datos persistan de esta manera, deben almacenarse en el disco y la gran pregunta es dónde escribir dicho archivo.</p>
<p>Este problema no es exclusivo de R. Muchas aplicaciones necesitan dejar notas para sí mismas. Es mejor cumplir con convenciones externas, que en este caso significa la <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">Especificación del directorio base XDG</a>. Debe utilizar las ubicaciones oficiales para el almacenamiento persistente de archivos, porque es algo responsable y cortés y también para cumplir con las políticas de CRAN.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Advertencia</span>Envío a CRAN
</div>
</div>
<div class="callout-body-container callout-body">
<p>No se pueden simplemente escribir datos persistentes en el directorio de inicio del usuario. Aquí hay un extracto relevante de la política de CRAN al momento de escribir este artículo:</p>
<blockquote class="blockquote">
<p>Los paquetes no deben escribirse en el espacio de archivos de inicio del usuario (incluidos los portapapeles) ni en ningún otro lugar del sistema de archivos aparte del directorio temporal de la sesión de R. …</p>
<p>Para R versión 4.0 o posterior (por lo tanto, se requiere una dependencia de versión o solo es posible un uso condicional), los paquetes pueden almacenar datos específicos del usuario, archivos de configuración y caché en sus respectivos directorios de usuario obtenidos de <code><a href="https://rdrr.io/r/tools/userdir.html">tools::R_user_dir()</a></code>, siempre que que por [sic] los tamaños predeterminados se mantengan lo más pequeños posible y los contenidos se administren activamente (incluida la eliminación de material obsoleto).</p>
</blockquote>
</div>
</div>
<p>La función principal que debe utilizar para derivar ubicaciones aceptables para los datos del usuario es <code><a href="https://rdrr.io/r/tools/userdir.html">tools::R_user_dir()</a></code><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Aquí hay algunos ejemplos de las rutas de archivos generadas.:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html">R_user_dir</a></span><span class="op">(</span><span class="st">"pkg"</span>, which <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/.local/share/R/pkg"</span></span>
<span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html">R_user_dir</a></span><span class="op">(</span><span class="st">"pkg"</span>, which <span class="op">=</span> <span class="st">"config"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/.config/R/pkg"</span></span>
<span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html">R_user_dir</a></span><span class="op">(</span><span class="st">"pkg"</span>, which <span class="op">=</span> <span class="st">"cache"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/.cache/R/pkg"</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Una última cosa que debe considerar con respecto a los datos persistentes es: ¿estos datos <em>realmente</em> necesitan persistir? ¿<em>Realmente</em> necesitas ser el responsable de almacenarlo?</p>
<p>Si los datos son potencialmente confidenciales, como las credenciales del usuario, se recomienda obtener el consentimiento del usuario para almacenarlos, es decir, requerir consentimiento interactivo al iniciar el caché. Considere también que el sistema operativo del usuario o las herramientas de línea de comandos podrían proporcionar un medio de almacenamiento seguro superior a cualquier solución de bricolaje que pueda implementar. Los paquetes <a href="https://cran.r-project.org/package=keyring">keyring</a>, <a href="https://gitcreds.r-lib.org">gitcreds</a>, y <a href="https://docs.ropensci.org/credentials/">credentials</a> son ejemplos de paquetes que aprovechan herramientas proporcionadas externamente. Antes de embarcarse en cualquier solución creativa para almacenar secretos, considere que probablemente sea mejor invertir su esfuerzo en integrarlo con una herramienta establecida.</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Si no sabe mucho sobre los entornos R y lo que los hace especiales, un gran recurso es el <a href="https://adv-r.hadley.nz/environments.html">capítulo Entornos</a> de R Avanzado.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Este ejemplo se ejecutará sin errores si define <code>favorite_letters</code>, <code>mfl()</code> y <code>set_mfl()</code> en el espacio de trabajo global y llama a <code>set_mfl()</code> en la consola. Pero este código fallará una vez que <code>favorite_letters</code>, <code>mfl()</code> y <code>set_mfl()</code> estén definidos <em>dentro de un paquete</em>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Tenga en cuenta que <code><a href="https://rdrr.io/r/tools/userdir.html">tools::R_user_dir()</a></code> apareció por primera vez en R 4.0. Si necesita admitir versiones anteriores de R, debe usar el [paquete rapppdirs] (https://rappdirs.r-lib.org), que es una adaptación del módulo appdirs de Python y que sigue la <a href="https://www.tidyverse.org/blog/2019/04/r-version-support/">política tidyverse con respecto al soporte de la versión R</a>, lo que significa que la versión R mínima admitida está avanzando y eventualmente pasará de R 4.0. rappdirs produce rutas de archivo diferentes a las de <code><a href="https://rdrr.io/r/tools/userdir.html">tools::R_user_dir()</a></code>. Sin embargo, ambas herramientas implementan algo que es consistente con la especificación XDG, solo que con diferentes opiniones sobre cómo crear rutas de archivos más allá de lo que dicta la especificación.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script>

  // Chapter name
  const currentChapterFile = window.location.pathname.split('/').pop().replace('.html', '');

  //Defining urls
  const originalURL = "https://github.com/hadley/r-pkgs/";
  const translationURL = "https://github.com/davidrsch/rpkgs-es";

  //Defining texts
  const edit_text = "Editar esta página";
  const issue_text = "Informar de un problema"

  //Defining git_i
  const git_i = '<div><i class="bi bi-github"></i></div>';

  // Adding TOC if not exist
  const sidebarmargin = document.getElementById('quarto-margin-sidebar');
  const buscar_TOC = document.getElementById('TOC');

  if (!buscar_TOC) {
    const crear_TOC = document.createElement('nav');
    crear_TOC.id = 'TOC';
    crear_TOC.role = "doc-toc";
    crear_TOC.class = "toc-active";
    sidebarmargin.appendChild(crear_TOC);
  }


  // Adding original github actions
  const TOC = document.getElementById('TOC');
  const originalga = document.createElement('h2');
  originalga.textContent = "Original";
  const toc_act_O = document.createElement('div');
  toc_act_O.className = 'toc-actions';
  toc_act_O.id = 'toc-act-O';
  const act_link_O = document.createElement('div');
  act_link_O.className='action-links';
  act_link_O.id='act-link-O';
  const edit_issue_O ='<p><a href="'+originalURL+'/edit/main/'+currentChapterFile+'.Rmd" class="toc-action">'+edit_text+'</p><p><a href="'+originalURL+'/issues/new" class="toc-action">'+issue_text+'</p>';


  TOC.appendChild(originalga);
  TOC.appendChild(toc_act_O);
  toc_act_O.innerHTML += git_i;
  toc_act_O.appendChild(act_link_O);
  act_link_O.innerHTML += edit_issue_O;

  // Adding translation github actions
  const translationga = document.createElement('h2');
  translationga.textContent = "Traducción";
  const toc_act_T = document.createElement('div');
  toc_act_T.className = 'toc-actions';
  toc_act_T.id = 'toc-act-T';
  const act_link_T = document.createElement('div');
  act_link_T.className='action-links';
  act_link_T.id='act-link-T';
  const edit_issue_T ='<p><a href="'+translationURL+'/edit/main/'+currentChapterFile+'.qmd" class="toc-action">'+edit_text+'</p><p><a href="'+translationURL+'/issues/new" class="toc-action">'+issue_text+'</p>';


  TOC.appendChild(translationga);
  TOC.appendChild(toc_act_T);
  toc_act_T.innerHTML += git_i;
  toc_act_T.appendChild(act_link_T);
  act_link_T.innerHTML += edit_issue_T;


</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiado");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiado");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/davidrsch\.github\.io\/rpkgs-es\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./code.html" class="pagination-link" aria-label="Código R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Código R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./misc.html" class="pagination-link" aria-label="Otros componentes">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Otros componentes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Paquetes de R fue escrito por Hadley Wickham y Jenny Bryan</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Este libro fue creado usando <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>